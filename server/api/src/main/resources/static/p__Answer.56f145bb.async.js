(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[6637],{91119:function(Re,G,n){"use strict";n.r(G),n.d(G,{MobileOrPC:function(){return ee},default:function(){return je}});var K=n(39428),ue=n(3182),ke=n(71194),D=n(50146),h=n(11849),de=n(68068),J=n(9761),$=n(1615),l=n(67294),q=n(5977),_=n(42285),ve=n(92725),U=n(12997),Oe=n(49111),ce=n(19650),Ne=n(57663),H=n(71577),ge=n(94657),Q=n(3980),fe=n(27400),me=n(73727),he=n(49914),w=n(96389),e=n(85893),we=(0,J.Pi)(function(){var c,Z,y=(0,_.YB)(),u=(0,he.H)(),i=(0,fe.a)(),b=u.success,L=(c=u.setting)===null||c===void 0?void 0:c.submittedSetting,R=(Z=u.setting)===null||Z===void 0?void 0:Z.answerSetting.loginRequired,g=u.survey,A=u.id,k=(0,l.useMemo)(function(){return g?(0,w.R6)(g):{}},[g]),j=L||{},p=j.contentHtml,f=j.redirectUrl,a=j.answerAnalysis,O=j.rankVisible,N=j.transcriptVisible,W=u.answerId,I=u.answerView,S=u.values;(0,l.useEffect)(function(){if(f&&S){if(!f.includes("(")){window.location.href=f;return}var M=(0,w.vW)(f,function(d){var P=(0,w.Op)(d),B=(0,ge.Z)(P,2),z=B[0],ae=B[1],X=S[z];return(0,w.d0)(k,X,d)});M.success&&(window.location.href=M.result)}},[f,S]),(0,l.useEffect)(function(){b&&g&&S&&I&&(0,w.MA)(g,p,S,I.examScore)},[p,b,g,S,I]);var m=function(){var d="";return a&&O?d=y.formatMessage({id:"pages.answer.result.viewRankingAndAnalysis",defaultMessage:"\u67E5\u770B\u6392\u540D\u53CA\u89E3\u6790"}):O?d=y.formatMessage({id:"pages.answer.result.viewRanking",defaultMessage:"\u67E5\u770B\u8003\u8BD5\u6392\u540D"}):(a||N)&&(d=y.formatMessage({id:"pages.answer.result.viewAnalysis",defaultMessage:"\u67E5\u770B\u7B54\u6848\u89E3\u6790"})),d?(0,e.jsx)("div",{children:(0,e.jsx)(H.Z,{onClick:function(){return window.open("/s/".concat(A,"/exam-result/").concat(W))},children:d})}):(0,e.jsx)(e.Fragment,{})};return b?(0,e.jsx)("div",{className:"survey-end animated",children:(0,e.jsx)("div",{className:"survey-end-content",children:(0,e.jsx)("h3",{className:"survey-end-title ",children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{id:"result-message"}),m(),(0,e.jsx)("div",{children:R&&(0,e.jsxs)(ce.Z,{children:[(0,e.jsx)(me.rU,{to:"/",children:(0,e.jsx)(H.Z,{type:"link",onClick:function(){},children:y.formatMessage({id:"pages.answer.result.backHome",defaultMessage:"\u8FD4\u56DE\u9996\u9875"})})}),(0,e.jsx)(H.Z,{type:"link",onClick:function(){i.logout(),(0,Q.on)()},children:y.formatMessage({id:"pages.answer.result.logoutClose",defaultMessage:"\u9000\u51FA\u5173\u95ED"})})]})})]})})})}):(0,e.jsx)(e.Fragment,{})}),xe=we;function ye(c){return l.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},c,{style:Object.assign({verticalAlign:"-0.125em"},c.style),className:["antd-mobile-icon",c.className].filter(Boolean).join(" ")}),l.createElement("g",{id:"ExclamationCircleFill-ExclamationCircleFill",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},l.createElement("g",null,l.createElement("rect",{id:"ExclamationCircleFill-\u77E9\u5F62",fill:"#D76060",opacity:0,x:0,y:0,width:48,height:48}),l.createElement("path",{d:"M24,2 C36.1502645,2 46,11.8497355 46,24 C46,36.1502645 36.1502645,46 24,46 C11.8497355,46 2,36.1502645 2,24 C2,11.8497355 11.8497355,2 24,2 Z M25.1,31 L22.9,31 C22.6790861,31 22.5,31.1790861 22.5,31.4 L22.5,31.4 L22.5,33.6 C22.5,33.8209139 22.6790861,34 22.9,34 L22.9,34 L25.1,34 C25.3209139,34 25.5,33.8209139 25.5,33.6 L25.5,33.6 L25.5,31.4 C25.5,31.1790861 25.3209139,31 25.1,31 L25.1,31 Z M25.1,14 L22.9,14 C22.6790861,14 22.5,14.1790861 22.5,14.4 L22.5,14.4 L22.5,27.6 C22.5,27.8209139 22.6790861,28 22.9,28 L22.9,28 L25.1,28 C25.3209139,28 25.5,27.8209139 25.5,27.6 L25.5,27.6 L25.5,14.4 C25.5,14.1790861 25.3209139,14 25.1,14 L25.1,14 Z",id:"ExclamationCircleFill-\u5F62\u72B6\u7ED3\u5408",fill:"currentColor",fillRule:"nonzero"}))))}var pe=ye,F=n(78210),Me=n(32235),ee=(0,J.Pi)(function(){var c,Z,y,u,i=(0,_.YB)(),b=(0,q.UO)(),L=b.id,R=b.answerId,g=(0,q.TH)(),A=g.query.preview==="1",k=g.query.pattern,j=g.query.openid,p=(0,l.useMemo)(function(){return(0,w.SB)()},[]),f=(0,l.useRef)(null),a=(0,l.useMemo)(function(){return new Me.b({surveyRef:f,id:L,answerId:R})},[f,L,R]),O=a.saving,N=a.loading,W=(c=a.setting)===null||c===void 0?void 0:c.answerSetting,I=a.loginRequired,S=a.verifying,m=W||{},M=m.autoSave,d=m.progressBar,P=m.initialValues,B=m.questionNumber,z=m.wechatOnly,ae=m.onePageOneQuestion,X=m.answerSheetVisible,Se=m.triggerType,Ce=m.copyEnabled,ne=((Z=a.setting)===null||Z===void 0?void 0:Z.examSetting)||{},Ze=ne.exerciseMode,T=ne.maxSwitchScreenTimes,be=!!((y=a.setting)!==null&&y!==void 0&&(u=y.examSetting)!==null&&u!==void 0&&u.randomSurveyWrong),Le=a.errorMessage,Y=a.savedAnswer,se=a.confirmTempAnswerType,Ee=a.statistics,E=a.survey,te=a.answerId,re=a.mode,ie=a.success,oe=(0,w.XO)(E,g);(0,l.useEffect)(function(){E&&(0,w.iq)(E,"statEnabled","quota")&&a.loadStatistics()},[E,a]);var Ve=(0,l.useCallback)(function(x,r){d&&a.changeProgress(r),M&&x&&a.tempSave(x)},[d]),Ae=function(){return(0,e.jsx)(U.BW,{})};(0,l.useEffect)(function(){if(T!==void 0){var x=!1;window.onfocus=function(){x=!0},window.onblur=function(){if(!!x){var r="ebt-".concat(L),t=parseInt(localStorage.getItem(r)||"0")+1;if(t>T){var s,C=(s=f.current)===null||s===void 0?void 0:s.getValues();a.saveData((0,h.Z)((0,h.Z)({},C),{},{openid:j}),{forceSubmit:!0}).then(function(o){o!=null&&o.success&&localStorage.removeItem(r),!(o!=null&&o.success)&&o!==null&&o!==void 0&&o.message&&(p?$.u_.alert({title:i.formatMessage({id:"pages.answer.saveFailed",defaultMessage:"\u4FDD\u5B58\u5931\u8D25"}),content:(0,e.jsx)(F.Z,{html:o.message})}):D.Z.error({title:i.formatMessage({id:"pages.answer.saveFailed",defaultMessage:"\u4FDD\u5B58\u5931\u8D25"}),content:(0,e.jsx)(F.Z,{html:o.message}),okText:i.formatMessage({id:"pages.answer.ok",defaultMessage:"\u77E5\u9053\u4E86"})}))});return}if(console.log("lose focus ".concat(t)),p){var v=i.formatMessage({id:"pages.answer.switchLimit",defaultMessage:"\u6700\u591A\u53EF\u4EE5\u5207\u5C4F {max} \u6B21\uFF0C\u68C0\u6D4B\u5230\u4F60\u5DF2\u5207\u6362\u4E86 {times} \u6B21\uFF0C\u8D85\u8FC7 {max} \u6B21\u95EE\u5377\u5C06\u5F3A\u5236\u63D0\u4EA4\u3002"},{max:T,times:t});$.u_.alert({header:(0,e.jsx)(pe,{style:{fontSize:64,color:"var(--adm-color-warning)"}}),title:i.formatMessage({id:"pages.answer.attention",defaultMessage:"\u6CE8\u610F"}),content:(0,e.jsx)("div",{children:v})})}else{var V=i.formatMessage({id:"pages.answer.switchLimit",defaultMessage:"\u6700\u591A\u53EF\u4EE5\u5207\u5C4F {max} \u6B21\uFF0C\u68C0\u6D4B\u5230\u4F60\u5DF2\u5207\u6362\u4E86 {times} \u6B21\uFF0C\u8D85\u8FC7 {max} \u6B21\u95EE\u5377\u5C06\u5F3A\u5236\u63D0\u4EA4\u3002"},{max:T,times:t});D.Z.warning({title:i.formatMessage({id:"pages.answer.notice",defaultMessage:"\u63D0\u793A"}),content:V,okText:i.formatMessage({id:"pages.answer.iKnow",defaultMessage:"\u6211\u77E5\u9053\u4E86"})})}localStorage.setItem(r,"".concat(t))}}}},[T]);var le=function(r){var t,s;return(0,e.jsxs)("div",{className:"render-failure ".concat(p?"mobile":"phone"),children:[((t=a.project)===null||t===void 0?void 0:t.name)&&(0,e.jsx)("div",{className:"title",children:(s=a.project)===null||s===void 0?void 0:s.name}),(0,e.jsxs)("div",{className:"content",children:[(0,e.jsx)("div",{children:(0,e.jsx)(U.AT,{})}),(0,e.jsx)("h2",{children:Le||r}),(0,e.jsx)("div",{children:i.formatMessage({id:"pages.answer.followThanks",defaultMessage:"\u611F\u8C22\u5173\u6CE8\uFF01"})})]})]})},Ie=function(){if(ie)return(0,e.jsx)(e.Fragment,{});if(N)return(0,e.jsx)(ve.Z,{});if(a.errorCode!==200)return le();if(z&&!(0,w.CL)())return le(i.formatMessage({id:"pages.answer.wechatOnly",defaultMessage:"\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00"}));if(I)return(0,e.jsx)("div",{children:Ae()});if(E&&!ie&&!S)return se===1&&M&&re==="survey"&&!te?(0,e.jsx)(U.oq,{}):(0,e.jsx)("div",{style:{userSelect:Ce===!1?"none":"unset"},children:(0,e.jsx)(de.Z,{ref:f,mode:re,loading:O||N,progressBar:d,questionNumber:B,theme:p?"antdMobile":"antd",schema:E,onChange:Ve,onePageOneQuestion:ae,answerSheetVisible:X,exerciseMode:Ze,wrongMode:be,pattern:k,triggerType:Se,onInit:function(t){a.tempSave(t.values)},onDictSearch:function(){var r=(0,ue.Z)((0,K.Z)().mark(function t(s){var C;return(0,K.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,Q.hi.loadDict(s);case 2:if(C=v.sent,!C.success){v.next=5;break}return v.abrupt("return",C.data);case 5:return v.abrupt("return",[]);case 6:case"end":return v.stop()}},t)}));return function(t){return r.apply(this,arguments)}}(),initialValues:se===3?oe:(0,h.Z)((0,h.Z)((0,h.Z)((0,h.Z)({},P),M?Y==null?void 0:Y.answer:{}),oe),a.values),statistics:Ee,onUpload:function(t,s){return a.upload(t,s)},footerVisible:!(A||k==="readPretty"),headerVisible:!A,isPreview:A,onLink:function(t){Q.hi.loadLinkResult((0,h.Z)((0,h.Z)({},t),{},{projectId:L})).then(function(s){if(s.success&&s.data.answer){var C=s.data.answer;Object.keys(C).forEach(function(V){var v=C[V];if(t.questionId!==V){var o;(o=f.current)===null||o===void 0||o.setValue(V,v)}})}})},onSubmit:function(t){a.saveData((0,h.Z)((0,h.Z)({},t),{},{openid:j}),{answerId:te}).then(function(s){!(s!=null&&s.success)&&s!==null&&s!==void 0&&s.message&&(p?$.u_.alert({title:i.formatMessage({id:"pages.answer.saveFailed",defaultMessage:"\u4FDD\u5B58\u5931\u8D25"}),content:(0,e.jsx)(F.Z,{html:s.message})}):D.Z.error({title:i.formatMessage({id:"pages.answer.saveFailed",defaultMessage:"\u4FDD\u5B58\u5931\u8D25"}),content:(0,e.jsx)(F.Z,{html:s.message}),okText:i.formatMessage({id:"pages.answer.ok",defaultMessage:"\u77E5\u9053\u4E86"})}))})}})})},Te=function(){return(0,e.jsx)(xe,{})},Fe=function(){var r,t,s=(r=a.survey)===null||r===void 0||(t=r.attribute)===null||t===void 0?void 0:t.backgroundImage;if(s)return{backgroundImage:"url(/api/public/preview/".concat(s,")")}};return(0,e.jsx)(w.ff.Provider,{value:a,children:(0,e.jsxs)("div",{className:"survey ".concat(p?"mobile":"pc"),style:Fe(),children:[Ie(),Te()]})})}),je=ee}}]);
