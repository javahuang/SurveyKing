(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[6420],{96:function(Et,ie,n){"use strict";n.r(ie),n.d(ie,{Overview:function(){return Ne},default:function(){return wt}});var I=n(11849),k=n(94657),a=n(67294),ke=n(5977),re=n(42285),Te=n(69968),le=n(8935),De=[{key:"answerDailyStat",i:"answerDailyStat",name:"answerDailyStat",title:"\u65E5\u6536\u96C6\u95EE\u5377",layouts:{md:{x:0,y:0,w:12,h:2,i:"answerDailyStat"},lg:{x:0,y:0,w:12,h:2,i:"answerDailyStat"}}},{key:"quickSetting",i:"quickSetting",name:"quickSetting",title:"\u7CFB\u7EDF\u8BBE\u7F6E",layouts:{md:{x:0,y:2,w:6,h:1,i:"quickSetting"},lg:{x:0,y:2,w:6,h:1,i:"quickSetting"}}}],we=De,pe=n(93224),Me=n(91512),Ae=n(68654),Ee=n(28508),J=n(11628),O=n(3980),K=n(9761),Re=n(54941),Pe=n(69610),Oe=n(27361),Fe=n.n(Oe),e=n(85893),ze=(0,Re.Z)(function c(){var t=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Pe.Z)(this,c),this._registry=void 0,this.registerComponent=function(d,v){t._registry[d]=v},this.getComponent=function(d){return Fe()(t._registry,"".concat(d),function(v){return(0,e.jsxs)("div",{children:[d,"\u5BF9\u5E94\u7EC4\u4EF6\u672A\u6CE8\u518C"]})})},this._registry=i}),Be=new ze,$=Be,Rt=a.createContext({}),ee=n(21063),oe=n(18111),Pt=n(71194),ue=n(50146),Ot=n(49111),ce=n(19650),Ft=n(59250),Ue=n(13013),zt=n(57663),z=n(71577),Bt=n(30887),de=n(28682),Ut=n(34792),B=n(48086),Lt=n(18106),ve=n(72488),te=n(11075),fe=n(40695),ne=n(31662),he=n(64072),Le=n(3471),Ye=n(64029),Ve=n(34804),We=n(43183),be=n(68068),Yt=n(47673),me=n(77808),He=me.Z.TextArea;function Ke(c){var t=(0,a.useState)(),i=(0,k.Z)(t,2),d=i[0],v=i[1];return(0,e.jsxs)(ue.Z,{open:!0,title:"\u786E\u8BA4",onOk:function(){return c.onOk(d)},onCancel:c.onCancel,okButtonProps:c.buttonProps,children:[(0,e.jsx)("div",{style:{fontWeight:"bold",marginBottom:10},children:"\u5904\u7406\u53CD\u9988"}),(0,e.jsx)(He,{placeholder:"\u5728\u6B64\u5904\u8F93\u5165\u5904\u7406\u53CD\u9988\uFF0C\u53EF\u4E0D\u586B\u76F4\u63A5\u63D0\u4EA4",value:d,onChange:function(l){return v(l.target.value)}})]})}var Vt=n(87593),ge=n(37636),Wt=n(22385),Qe=n(94199),bt=n(94233),ae=n(51890),Ge=n(94184),ye=n.n(Ge),Je=n(89366),$e={save:"blue",agree:"green",refuse:"red",reject:"red",revoke:"red",transfer:"red",todo:"orange"},W=function(t){return(0,e.jsx)(Qe.Z,{placement:"bottom",title:(0,e.jsxs)("div",{style:{textAlign:"center",fontSize:12},children:[t.name,(0,e.jsx)("br",{}),t.email]}),children:t.avatar?(0,e.jsx)(ae.C,{src:"/api/public/preview/".concat(t.avatar),size:22}):(0,e.jsx)(ae.C,{icon:(0,e.jsx)(Je.Z,{}),size:22})})},Xe=function(t){var i=function(){if(t.approvalType==="save"){var v;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(W,(0,I.Z)({},t.auditUser)),(v=t.auditUser)===null||v===void 0?void 0:v.name," \u53D1\u8D77\u65B0\u7684"]})}else if(t.approvalType==="agree"){var r;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(W,(0,I.Z)({},t.auditUser)),(r=t.auditUser)===null||r===void 0?void 0:r.name," \u5BA1\u6279\u901A\u8FC7"]})}else if(t.approvalType==="todo"){var l,s;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ae.C.Group,{maxCount:3,children:(l=t.waitAuditUserList)===null||l===void 0?void 0:l.filter(function(Z){return!!Z}).map(function(Z){return(0,a.createElement)(W,(0,I.Z)((0,I.Z)({},Z),{},{key:Z.userId}))})}),(s=t.waitAuditUserList)===null||s===void 0?void 0:s.length,"\u6210\u5458\u5904\u7406\u4E2D..."]})}else if(t.approvalType==="refuse"){var m;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(W,(0,I.Z)({},t.auditUser)),(m=t.auditUser)===null||m===void 0?void 0:m.name," \u5BA1\u6279\u62D2\u7EDD"]})}else if(t.approvalType==="rollback"){var x;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(W,(0,I.Z)({},t.auditUser)),(x=t.auditUser)===null||x===void 0?void 0:x.name," \u56DE\u9000\u81F3 ",t.newActivityName]})}else if(t.approvalType==="revert"){var g;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(W,(0,I.Z)({},t.auditUser)),(g=t.auditUser)===null||g===void 0?void 0:g.name," \u64A4\u9500\u5904\u7406"]})}};return(0,e.jsxs)(ge.Z.Item,{color:$e[t.approvalType]||"gray",children:[(0,e.jsx)("div",{className:"audit-time",children:t.createAt}),(0,e.jsxs)("div",{className:"record-item",children:[(0,e.jsx)("div",{className:"item-header",children:t.activityName}),(0,e.jsxs)("div",{className:"item-content",children:[(0,e.jsxs)("div",{className:"content-row",children:[(0,e.jsx)("span",{className:ye()("action",t.approvalType),children:i()}),(0,e.jsx)("span",{})]}),t.comment&&(0,e.jsx)("div",{className:"content-row",children:(0,e.jsx)("span",{className:"comment",children:t.comment})})]})]})]},t.id)},qe=function(t){var i=t.processInstanceId,d=(0,a.useState)(),v=(0,k.Z)(d,2),r=v[0],l=v[1];return(0,a.useEffect)(function(){O.hi.getAuditRecord(i).then(function(s){l(s)})},[i]),(0,a.useEffect)(function(){var s=document.getElementsByClassName("ant-tabs-content-holder");s.length>0&&(s[0].scrollTop=s[0].scrollHeight)},[r]),(0,e.jsx)(ge.Z,{className:"audit-timeline",children:r==null?void 0:r.map(function(s){return(0,a.createElement)(Xe,(0,I.Z)((0,I.Z)({},s),{},{key:s.id||s.activityId}))})})},xe=ve.Z.TabPane,V="task-edit-modal",_e=(0,K.Pi)(function(c){var t=c.currentRecord,i=c.currIndex,d=c.total,v=c.onClose,r=c.onNav,l=c.taskType,s=(0,a.useState)(345),m=(0,k.Z)(s,2),x=m[0],g=m[1],Z=(0,a.useRef)(null),F=(0,a.useState)(),T=(0,k.Z)(F,2),A=T[0],U=T[1],S=(0,a.useRef)(null),E=(0,a.useState)([]),D=(0,k.Z)(E,2),C=D[0],R=D[1],o=(0,a.useState)(),h=(0,k.Z)(o,2),u=h[0],f=h[1];(0,a.useEffect)(function(){O.hi.loadFlowSchema({activityId:t.activityId,projectId:t.projectId}).then(function(M){return U(M)})},[t]);var w=(0,a.useState)(!1),b=(0,k.Z)(w,2),p=b[0],j=b[1];(0,a.useEffect)(function(){var M,P=t.answer,y=t.attachment;(M=S.current)===null||M===void 0||M.setValues(P,y)},[t]);var Y=function(){return A?(0,e.jsx)(be.O,{ref:S,schema:A,headerVisible:!1,footerVisible:!1,paginationVisible:!1,initialValues:t.answer,fieldPermission:t.fieldPermission}):(0,e.jsx)(e.Fragment,{})},_=function(P){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(P==="up"?i-1:i+1,y)},H=function(){return(0,e.jsx)("div",{style:{position:"absolute",height:"100%",width:"100%",overflow:"hidden"},children:(0,e.jsxs)(ve.Z,{defaultActiveKey:"1",children:[(0,e.jsx)(xe,{tab:"\u65E5\u5FD7",children:(0,e.jsx)(qe,{processInstanceId:t.processInstanceId})},"1"),(0,e.jsx)(xe,{tab:"\u7559\u8A00",children:"Content of Tab Pane 2"},"2")]})})},pt=function(){return(0,e.jsx)(de.Z,{onClick:function(y){var N,G=y.key;(N=S.current)===null||N===void 0||N.submit().then(function(L){L?f({visible:!0,buttonProps:{type:"ghost",icon:(0,e.jsx)(te.Z,{})},callback:function(At){j(!0),O.hi.approvalTask({answer:L.values,attachment:L.attachments,answerId:t.answerId,taskId:t.id,type:"rollback",activityId:t.activityId,comment:At,projectId:t.projectId,processInstanceId:t.processInstanceId,newActivityId:G}).then(function(){B.default.success("\u5DF2\u56DE\u9000"),j(!1),f(void 0),r(i,!0)})}}):j(!1)})},children:C==null?void 0:C.map(function(P,y){return(0,e.jsx)(de.Z.Item,{children:(0,e.jsx)("a",{children:y!==C.length-1?P.activityName:"\u53D1\u8D77\u4EBA"})},P.activityId)})})},Mt=function(){return(0,e.jsxs)(ce.Z,{children:[l===1&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z.Z,{type:"primary",loading:p,icon:(0,e.jsx)(fe.Z,{}),onClick:function(){var y;(y=S.current)===null||y===void 0||y.submit().then(function(N){N?f({visible:!0,buttonProps:{type:"primary",icon:(0,e.jsx)(fe.Z,{})},callback:function(L){j(!0),O.hi.approvalTask({answer:N.values,attachment:N.attachments,answerId:t.answerId,taskId:t.id,type:"agree",activityId:t.activityId,comment:L,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){B.default.success("\u5BA1\u6838\u901A\u8FC7"),j(!1),f(void 0),r(i,!0)})}}):j(!1)})},children:"\u901A\u8FC7"}),(0,e.jsx)(z.Z,{type:"primary",danger:!0,icon:(0,e.jsx)(ne.Z,{}),loading:p,onClick:function(){var y;(y=S.current)===null||y===void 0||y.submit().then(function(N){N?f({visible:!0,buttonProps:{type:"primary",danger:!0,icon:(0,e.jsx)(ne.Z,{})},callback:function(L){j(!0),O.hi.approvalTask({answer:N.values,attachment:N.attachments,answerId:t.answerId,taskId:t.id,type:"refuse",activityId:t.activityId,comment:L,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){B.default.success("\u5DF2\u62D2\u7EDD"),j(!1),f(void 0),r(i,!0)})}}):j(!1)})},children:"\u62D2\u7EDD"}),(0,e.jsx)(Ue.Z,{overlay:pt,placement:"topCenter",trigger:["click"],children:(0,e.jsx)(z.Z,{onClick:function(){O.hi.getRevertNodes(t.processInstanceId).then(function(y){y&&R(y)})},icon:(0,e.jsx)(te.Z,{}),loading:p,children:"\u56DE\u9000"})})]}),l===2&&t.status===1&&t.latest&&t.approvalType!=="revert"&&(0,e.jsx)(z.Z,{onClick:function(){var y;(y=S.current)===null||y===void 0||y.submit().then(function(N){N?f({visible:!0,buttonProps:{type:"primary",danger:!0,icon:(0,e.jsx)(ne.Z,{})},callback:function(L){j(!0),O.hi.approvalTask({answer:N.values,attachment:N.attachments,answerId:t.answerId,taskId:t.id,type:"revert",activityId:t.activityId,newActivityId:t.activityId,comment:L,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){B.default.success("\u5DF2\u64A4\u56DE"),j(!1),f(void 0),r(i,!0)})}}):j(!1)})},icon:(0,e.jsx)(te.Z,{}),loading:p,children:"\u64A4\u56DE"}),l===4&&t.status===6&&(0,e.jsx)(z.Z,{onClick:function(){var y;(y=S.current)===null||y===void 0||y.submit().then(function(N){N?f({visible:!0,buttonProps:{type:"primary",icon:(0,e.jsx)(he.Z,{})},callback:function(L){j(!0),O.hi.approvalTask({answer:N.values,attachment:N.attachments,answerId:t.answerId,taskId:t.id,type:"save",activityId:t.activityId,comment:L,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){B.default.success("\u5DF2\u64A4\u56DE"),j(!1),f(void 0),r(i,!0)})}}):j(!1)})},icon:(0,e.jsx)(he.Z,{}),loading:p,children:"\u518D\u6B21\u63D0\u4EA4"}),(0,e.jsx)(z.Z,{onClick:function(){},icon:(0,e.jsx)(Le.Z,{}),loading:p})]})};return(0,e.jsx)("div",{ref:Z,className:"edit-data ",children:(0,e.jsxs)(ue.Z,{open:!0,maskClosable:!1,title:!1,width:900,onCancel:function(){return v()},className:"task-edit-modal",footer:!1,children:[(0,e.jsxs)("div",{style:{display:"flex"},children:[(0,e.jsxs)("div",{className:V+"-survey-container",style:{flex:1},children:[(0,e.jsx)("div",{className:V+"-survey-container-title",children:"\u6211\u7684\u5BA1\u6279"}),(0,e.jsx)("div",{className:V+"-survey-container-content",children:Y()}),(0,e.jsxs)("div",{className:V+"-survey-container-footer",children:[(0,e.jsxs)("div",{className:"nav",children:[(0,e.jsxs)("span",{children:[i+1,"/",d]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(z.Z,{type:"text",shape:"circle",icon:(0,e.jsx)(Ye.Z,{}),disabled:i===0,onClick:function(){return _("up")}}),(0,e.jsx)(z.Z,{type:"text",shape:"circle",icon:(0,e.jsx)(Ve.Z,{}),disabled:i===d-1,onClick:function(){return _("down")}})]})]}),Mt()]})]}),(0,e.jsxs)("div",{className:V+"-metaInfo-container",style:{width:x},children:[(0,e.jsx)("div",{className:V+"-metaInfo-container-title"}),(0,e.jsx)("div",{className:V+"-metaInfo-container-content",children:H()}),(0,e.jsx)("div",{className:V+"-metaInfo-container-resizer",style:{transform:x===0?"rotateY(180deg) translate3d(100%,-50%,0)":"translate3d(0,-50%,0)"},onClick:function(){g(x===0?350:0)},children:(0,e.jsx)(We.Z,{})})]})]}),(u==null?void 0:u.visible)&&(0,e.jsx)(Ke,{onOk:function(P){return u.callback(P)},onCancel:function(){return f(void 0)},buttonProps:u.buttonProps})]})})}),et=(0,K.Pi)(function(c){var t=c.projectId,i=c.taskType,d=(0,a.useContext)(se),v=(0,O.iZ)(t),r=(0,O.Ge)(t),l=(0,a.useRef)(),s=r.tasks[i]||{list:[],total:0,current:1,pageSize:50},m=(0,a.useState)(),x=(0,k.Z)(m,2),g=x[0],Z=x[1],F=(0,a.useState)(),T=(0,k.Z)(F,2),A=T[0],U=T[1];(0,a.useEffect)(function(){var o=s.list.length;if(g===void 0){U(void 0);return}if(o===0){Z(void 0);return}if(g>=o){Z(0);return}g!==void 0&&s.current&&s.total&&U({currIndex:g,total:s.total,currentRecord:s.list[g]})},[g,s]);var S=function(h,u){r.loadFlowTasks({type:i,projectId:t,current:h,pageSize:u})};(0,a.useEffect)(function(){(i||g===void 0)&&S()},[i,g]);var E=v.schema,D=(0,a.useMemo)(function(){var o=(0,oe.ZZ)(E)||[];return o.splice(0,0,{name:"approvalStage",title:"\u5F53\u524D\u6D41\u7A0B\u72B6\u6001",width:180}),o.push({name:"createUser",title:"\u7533\u8BF7\u4EBA"}),o.push({name:"createAt",title:"\u7533\u8BF7\u65F6\u95F4",width:180}),o.push({name:"updateAt",title:"\u66F4\u65B0\u65F6\u95F4",width:180}),o},[E]),C=(0,a.useMemo)(function(){var o=(0,oe.IR)(s.list,D);return o.forEach(function(h){var u;h.createUser=(u=h.createUser)===null||u===void 0?void 0:u.name}),o},[s,D]),R=function(h,u){A&&(u?r.removeTask(A.currentRecord.id,i):Z(h))};return(0,e.jsxs)("div",{children:[(0,e.jsx)(ee._$,{ref:l,width:d.width-10,height:d.height-95,data:C,schema:D,selectionMode:"row",allowSorting:!0,onDoubleClick:function(h){var u;if(((u=h.data)===null||u===void 0?void 0:u._i)!==void 0){var f;Z((f=h.data)===null||f===void 0?void 0:f._i)}}}),(0,e.jsxs)("div",{className:"statusBar-container",children:[(0,e.jsx)("div",{children:(0,e.jsx)("div",{style:{fontSize:12,color:"##767e89",userSelect:"none"},children:"\u53CC\u51FB\u884C\u5BA1\u6279"})}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ee.tl,{current:s.current,pageSize:s.pageSize,total:s.total,onChange:function(h){S(h.current,h.pageSize)}}),(0,e.jsx)(ee.hY,{onClick:function(){return S(s.current,s.pageSize)}})]}),(0,e.jsx)("div",{})]}),A&&(0,e.jsx)(_e,(0,I.Z)((0,I.Z)({},A),{},{taskType:i,onClose:function(){Z(void 0)},onNav:R}))]})}),tt=(0,K.Pi)(function(c){var t=(0,a.useContext)(J.xI),i=(t==null?void 0:t.id)||c.projectId,d=(0,O.iZ)(i),v=Nt();return(0,a.useEffect)(function(){d.loadProject()},[d,i]),(0,e.jsx)("div",{style:{padding:"2px 5px"},className:"task-widget",children:(0,e.jsx)(et,{projectId:i,taskType:parseInt(v.activeKey||"0")})})});$.registerComponent("taskCenter",tt);var Ht=n(13062),je=n(71230),Kt=n(77576),Se=n(12028),Qt=n(89032),X=n(15746),Gt=n(20136),nt=n(55241),q=n(39428),Ce=n(3182),at=n(23538),Ie=n(92592),st=me.Z.Search;function it(c){return"".concat(window.location.origin,"/s/").concat(c)}var rt=function(){var t,i,d,v,r=(0,J.IE)(),l=(0,re.YB)(),s=(t=r.project)===null||t===void 0||(i=t.setting)===null||i===void 0?void 0:i.status,m=(0,a.useState)(s===1),x=(0,k.Z)(m,2),g=x[0],Z=x[1],F=(d=r.project)===null||d===void 0||(v=d.setting)===null||v===void 0?void 0:v.answerSetting.autoSave,T=(0,a.useState)(F),A=(0,k.Z)(T,2),U=A[0],S=A[1];(0,a.useEffect)(function(){Z(s===1)},[s]),(0,a.useEffect)(function(){S(F)},[F]);var E=it(r.id),D=(0,a.useState)(""),C=(0,k.Z)(D,2),R=C[0],o=C[1];(0,a.useEffect)(function(){function u(){return f.apply(this,arguments)}function f(){return f=(0,Ce.Z)((0,q.Z)().mark(function w(){return(0,q.Z)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:Ie.toDataURL(E,{errorCorrectionLevel:"H",type:"image/jpeg",quality:.3,margin:1}).then(function(j){o(j)}).catch(function(j){console.error(j)});case 1:case"end":return p.stop()}},w)})),f.apply(this,arguments)}u()},[E]);var h=(0,a.useCallback)(function(){var u=(0,Ce.Z)((0,q.Z)().mark(function f(w){return(0,q.Z)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:Ie.toDataURL(E,{errorCorrectionLevel:"H",margin:1,width:w}).then(function(j){o(j);var Y=document.createElement("a");Y.href=j,Y.setAttribute("download","".concat(r.name,"_").concat(w,".png")),document.body.appendChild(Y),Y.click(),document.body.removeChild(Y)});case 1:case"end":return p.stop()}},f)}));return function(f){return u.apply(this,arguments)}}(),[E,r]);return(0,e.jsx)(je.Z,{gutter:[20,20],style:{padding:10},children:(0,e.jsx)(X.Z,{sm:24,xs:24,children:(0,e.jsxs)(je.Z,{gutter:[10,10],children:[(0,e.jsxs)(X.Z,{span:24,className:"setting-item",children:[(0,e.jsx)(st,{value:E,style:{width:360},enterButton:l.formatMessage({id:"pages.survey.overview.quickSetting.action.open",defaultMessage:"\u6253\u5F00"}),className:"open-target",onSearch:function(){window.open("/s/".concat(r.id))}}),(0,e.jsx)(nt.Z,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("img",{src:R,height:150,width:150}),(0,e.jsx)("div",{style:{textAlign:"center"},children:(0,e.jsxs)(ce.Z,{children:[(0,e.jsx)(z.Z,{size:"small",type:"link",onClick:function(){return h(256)},children:l.formatMessage({id:"pages.survey.overview.quickSetting.qr.download.small",defaultMessage:"\u5C0F\u53F7"})}),(0,e.jsx)(z.Z,{size:"small",type:"link",onClick:function(){return h(512)},children:l.formatMessage({id:"pages.survey.overview.quickSetting.qr.download.medium",defaultMessage:"\u4E2D\u53F7"})}),(0,e.jsx)(z.Z,{size:"small",type:"link",onClick:function(){return h(1024)},children:l.formatMessage({id:"pages.survey.overview.quickSetting.qr.download.large",defaultMessage:"\u5927\u53F7"})})]})})]}),title:l.formatMessage({id:"pages.survey.overview.quickSetting.qr.title",defaultMessage:"{name}(\u4E8C\u7EF4\u7801)"},{name:r.name}),trigger:["click"],children:(0,e.jsx)(at.Z,{style:{fontSize:30}})})]}),(0,e.jsxs)(X.Z,{className:"setting-item",span:24,children:[(0,e.jsx)("div",{className:"title",children:l.formatMessage({id:"pages.survey.overview.quickSetting.status.title",defaultMessage:"\u95EE\u5377\u5F00\u542F/\u505C\u6B62"})}),(0,e.jsx)("div",{children:(0,e.jsx)(Se.Z,{checked:g,onChange:function(f){Z(f),O.hi.updateSetting({id:r.id,settingKey:"status",settingValue:f?1:0}).then(function(w){w.code===200?f?B.default.info(l.formatMessage({id:"pages.survey.overview.quickSetting.status.opened",defaultMessage:"\u95EE\u5377\u5DF2\u5F00\u542F"})):B.default.warn(l.formatMessage({id:"pages.survey.overview.quickSetting.status.closed",defaultMessage:"\u95EE\u5377\u5DF2\u505C\u6B62"})):B.default.error(w.message)})}})})]}),(0,e.jsxs)(X.Z,{className:"setting-item",span:24,children:[(0,e.jsx)("div",{className:"title",children:l.formatMessage({id:"pages.survey.overview.quickSetting.autoSave.title",defaultMessage:"\u95EE\u5377\u586B\u5199\u65F6\u81EA\u52A8\u4FDD\u5B58"})}),(0,e.jsx)("div",{children:(0,e.jsx)(Se.Z,{checked:U,onChange:function(f){S(f),O.hi.updateSetting({id:r.id,settingKey:"answerSetting.autoSave",settingValue:f}).then(function(w){w.code===200?f?B.default.info(l.formatMessage({id:"pages.survey.overview.quickSetting.autoSave.enabled",defaultMessage:"\u6682\u5B58\u5DF2\u5F00\u542F"})):B.default.warn(l.formatMessage({id:"pages.survey.overview.quickSetting.autoSave.disabled",defaultMessage:"\u6682\u5B58\u5DF2\u505C\u6B62"})):B.default.error(w.message)})}})})]})]})})})};$.registerComponent("quickSetting",(0,K.Pi)(rt));var lt=n(68023),ot=n(81615),ut=n(8690),ct=n(17813),dt=n(73761),vt=n(73865),ft=n(60532),ht=n(37744),mt=n(5931),gt=n(79813),yt=n(70012),xt=n(27484),Q=n.n(xt),jt=n(37181),St=n.n(jt);Q().extend(St()),lt.D([ut.N,ct.N,dt.N,vt.N,mt.N,yt.N,gt.z,ft.N,ht.N]);var Ze=function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=Q()(),d=Q().min(Object.keys(t).map(function(m){return Q()(m,"YYYY-MM-DD")}).concat(i.add(-6,"day"))),v=[],r=[],l=d;!Q()().add(1,"day").isSame(l,"day");l=l.add(1,"day")){var s=l.format("YYYY-MM-DD");v.push(s),r.push(t[s]||0)}return{dateList:v,data:r}},Ct=function(t){var i=(0,J.IE)(),d=i.reportData,v=(0,a.useRef)(),r=(0,a.useRef)(null);return(0,a.useEffect)(function(){if(r.current){var l=ot.S1(r.current);v.current=l;var s,m=Ze();s={visualMap:[{show:!1,type:"continuous",seriesIndex:0,min:0,max:400}],tooltip:{trigger:"axis"},xAxis:[{data:m.dateList}],dataZoom:[{type:"inside",startValue:"2022-05-03",endValue:"2022-05-08"},{start:0,end:20}],yAxis:[{}],series:[{type:"line",showSymbol:!1,smooth:!0,symbol:"none",areaStyle:{},data:m.data}]},s&&l.setOption(s),l.resize({height:t.height-30})}},[]),(0,a.useEffect)(function(){i.loadReportData()},[]),(0,a.useEffect)(function(){if(d&&v.current&&d.dailyCountStat){var l=Ze(d.dailyCountStat),s=l.dateList,m=l.data;v.current.setOption({xAxis:[{data:s}],series:[{data:m}]})}},[d]),(0,a.useEffect)(function(){v.current&&v.current.resize({height:t.height-30,width:t.width})},[t.width,t.height]),(0,e.jsx)("div",{ref:r})};$.registerComponent("answerDailyStat",(0,K.Pi)(Ct));var It=function(t){var i=t.tabs,d=t.defaultActive,v=(0,a.useState)(d||i[0].key),r=(0,k.Z)(v,2),l=r[0],s=r[1],m=function(g){s(g),t.onChange(g)};return(0,e.jsx)("div",{className:"tabs-nav-list",children:i.map(function(x){return(0,e.jsx)("div",{onClick:function(){return m(x.key)},className:ye()("tabs-tab",{active:l===x.key}),children:x.title},x.key)})})},Zt=["style","className","key","children","name","title","tabs","widgetProps","toggleFullScreen"],se=a.createContext({});function Nt(){return(0,a.useContext)(se)}var kt=a.forwardRef(function(c,t){var i=c.style,d=c.className,v=c.key,r=c.children,l=c.name,s=c.title,m=c.tabs,x=c.widgetProps,g=c.toggleFullScreen,Z=(0,pe.Z)(c,Zt),F=(0,a.useState)(m&&m[0].key),T=(0,k.Z)(F,2),A=T[0],U=T[1],S=(0,a.useState)(!1),E=(0,k.Z)(S,2),D=E[0],C=E[1],R=function(){return m?(0,e.jsx)(It,{tabs:m,onChange:function(u){return U(u)}}):(0,e.jsx)("span",{className:"",children:s})};return(0,e.jsxs)("div",(0,I.Z)((0,I.Z)({style:(0,I.Z)({},i),className:["widget",d].join(" ")},Z),{},{ref:t,children:[(0,e.jsxs)("div",{className:"header",children:[(0,e.jsxs)("span",{className:"title",children:[R(),(0,e.jsx)("div",{className:"drag-handle"})]}),(0,e.jsxs)("div",{className:"widget-controls",children:[D&&(0,e.jsx)(Me.Z,{className:"control-item",onClick:function(){C(!1),g()}}),!D&&(0,e.jsx)(Ae.Z,{className:"control-item",onClick:function(){C(!0),g()}}),(0,e.jsx)(Ee.Z,{className:"control-item"})]})]}),(0,e.jsx)(le.SizeMe,{monitorHeight:!0,children:function(h){var u=h.size;return(0,e.jsx)(se.Provider,{value:{height:u.height||0,width:u.width||0,activeKey:A},children:(0,e.jsx)("div",{style:{height:"100%"},children:a.createElement($.getComponent(l),(0,I.Z)((0,I.Z)({},x),{},{height:u.height,width:u.width}))})})}}),r]}),v)}),Tt=kt,Dt=n(53425),Ne=function(t){var i=(0,ke.UO)(),d=i.id,v=(0,J.IE)(),r=v.id,l=(0,re.YB)(),s=(0,a.useState)(function(){return we}),m=(0,k.Z)(s,2),x=m[0],g=m[1],Z=(0,a.useState)(function(){var D=localStorage.getItem("layout-".concat(r));return D!=null?JSON.parse(D):x.reduce(function(C,R){return C.lg.push(R.layouts.lg),C.md.push(R.layouts.md),C},{lg:[],md:[]})}),F=(0,k.Z)(Z,2),T=F[0],A=F[1],U=(0,a.useRef)(0),S=(0,a.useRef)();if(d==="new")return(0,e.jsx)(Dt.default,(0,I.Z)({},t));var E=function(C){if(S.current)A(S.current.cacheLayouts),g(S.current.cacheData),S.current=void 0;else if(T){S.current={key:C,cacheData:x,cacheLayouts:T};var R=Object.keys(T).reduce(function(o,h){var u=T[h].filter(function(f){return f.i===C})[0];return o[h]=[(0,I.Z)((0,I.Z)({},u),{},{x:0,y:0,h:(U.current-100)/150,i:C,statusbar:!0})],o},{});A(R),g(x.filter(function(o){return o.key===C}))}};return(0,e.jsx)("div",{className:"survey-overview",children:(0,e.jsx)(le.SizeMe,{monitorHeight:!0,children:function(C){var R=C.size;return U.current=R.height||0,(0,e.jsx)(Te.Responsive,{autoSize:!1,className:"layout",onDrag:function(h){},draggableHandle:".drag-handle",breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:12,sm:12,xs:4,xxs:2},width:R.width||0,layouts:T,useCSSTransforms:!1,onLayoutChange:function(h,u){S.current||localStorage.setItem("layout-".concat(r),JSON.stringify(u))},children:x.map(function(o){var h=o.key,u=o.title,f=o.tabs,w=o.name,b=o.widgetProps,p=o.className,j=o.style,Y=l.formatMessage({id:"pages.survey.overview.widget.".concat(w,".title"),defaultMessage:u}),_=f==null?void 0:f.map(function(H){return(0,I.Z)((0,I.Z)({},H),{},{title:l.formatMessage({id:"pages.survey.overview.widget.".concat(w,".tab.").concat(H.key),defaultMessage:H.title})})});return(0,e.jsx)(Tt,{name:w,widgetProps:b,className:p,style:j,title:Y,tabs:_,toggleFullScreen:function(){return E(h)}},h)})})}})})},wt=Ne}}]);
