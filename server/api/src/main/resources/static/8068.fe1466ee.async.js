(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[8068],{68068:function(le,X,u){"use strict";u.d(X,{O:function(){return se},Z:function(){return Ne}});var W=u(9761),O=u(67294),K=u(3044),Y=u(86052),k=u(48187),q=u(91220),_=u(93224),Z=u(39428),j=u(83279),N=u(3182),V=u(11849),te=u(94657),ue=u(69610),oe=u(54941),ee=u(3980),R=u(64031),y=u(54531);function de(l,e){}var $=u(40807),fe=["visible"],ve=function(){function l(e){var r=this,i;(0,ue.Z)(this,l),this.props=void 0,this.progress=0,this.form=void 0,this.pagination={current:1,pageSize:1,currentIndex:0,paginationNodes:[]},this.unmount=!1,this.notNoneInQuestionGroup=[],this.answerSheet=[],this.answerSheetVisible=!1,this.reviewAnswer={},this.autoNextPage=void 0,this.compute=void 0,this.hiddenOption={},this.visibleId=void 0,this.lazy=!1,this.preloadId=void 0;var n=e.initialValues,t=e.readOnly,a=e.fieldPermission,s=e.theme,o=e.schema,f=e.mode,v=e.onePageOneQuestion,m=v===void 0?!1:v,p=e.paginationVisible;this.props=e,this.lazy=!!e.onLazyLoad,this.initPagination(o,p,m);var c=(0,R.Np)({initialValues:n,readOnly:t,validateFirst:!0,pattern:e.pattern,effects:function(h){(0,R.dQ)(function(){if(a){var d=[],x=[];Object.entries(a).forEach(function(P){var M=(0,te.Z)(P,2),w=M[0],S=M[1];S===0?d.push(w):S===1&&x.push(w)}),d.length>0&&c.setFieldState("*(".concat(d.join(","),")"),function(P){return P.display="none"}),x.length>0&&c.setFieldState("*(".concat(x.join(","),")"),function(P){return P.pattern="readPretty"})}r.handleFormValuesChange(),r.highlightJs(),r.setVisible(0)}),(0,R.pO)(function(d){r.handleFormValuesChange()}),(0,R.Zj)("*",function(d,x){r.handleFieldValueChange(d,x)}),de(o,h)}});this.form=c,this.answerSheet=((i=this.lazy?o.children:(0,$.Xn)(o))===null||i===void 0?void 0:i.filter(function(g){var h,d;return r.lazy||(0,$.a1)(g.type)&&((h=g.attribute)===null||h===void 0?void 0:h.display)!=="hidden"&&((d=g.attribute)===null||d===void 0?void 0:d.examAnswerMode)!=="none"}).map(function(g){var h,d=(h=e.initialQuestionScore)===null||h===void 0?void 0:h[g.id];return{finished:!1,id:g.id,marked:!1,display:r.lazy?"hidden":"visible",favorite:!!e.wrongMode,isCorrect:d===void 0?void 0:d>0}}))||[],s==="antd"&&f==="exam"&&(this.answerSheetVisible=!0),this.autoNextPage=0,e.exerciseMode&&e.onePageOneQuestion&&(this.autoNextPage=1),this.makeObservable(),this.props.correctAnswerVisible&&n&&(0,$.Xn)(o).forEach(function(g){r.computeReviewAnswer(g,n[g.id]).then(function(h){h&&(r.reviewAnswer[g.id].visible=!0)})}),this.compute=ce(function(){r.unmount||(r.lazy||r.reOrder(),r.computePagination())},10)}return(0,oe.Z)(l,[{key:"makeObservable",value:function(){(0,y.Ou)(this,{progress:y.LO.ref,pagination:y.LO,form:y.LO.ref,props:y.LO.shallow,answerSheet:y.LO,answerSheetVisible:y.LO.ref,reviewAnswer:y.LO,notNoneInQuestionGroup:y.LO,schema:y.LO.computed,autoNextPage:y.LO.ref,hiddenOption:y.LO.shallow,exerciseMode:y.LO.computed,lazy:y.LO.ref,visibleId:y.LO.ref,computeProgress:y.aD,validate:y.aD,handlePrev:y.aD,handleNext:y.aD,submit:y.aD,handleFormValuesChange:y.aD,changePageIndex:y.aD,handleFieldValueChange:y.aD,computeReviewAnswer:y.aD,reOrder:y.aD})}},{key:"schema",get:function(){return(0,y.ZN)(this.props.schema)}},{key:"questionsGroupByPagination",get:function(){return this.pagination.paginationNodes}},{key:"exerciseMode",get:function(){return this.props.exerciseMode||!1}},{key:"initPagination",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;i?this.pagination.paginationNodes=(0,$._T)(r,n,this.lazy):this.pagination.paginationNodes=[r.children],this.pagination.pageSize=this.pagination.paginationNodes.length}},{key:"computePagination",value:function(){if(this.props.paginationVisible===!1)return;var r=this.form.fields,i=this.pagination,n=i.paginationNodes,t=i.currentIndex;if(this.lazy){this.pagination=(0,V.Z)((0,V.Z)({},this.pagination),{},{pageSize:n.length,currentIndex:t,current:t+1});return}function a(m){return n[m].every(function(p){var c,g=((c=r[p.id])===null||c===void 0?void 0:c.data)||[];return g.some(function(h){return h==="self_display"||h.startsWith("rule_")})})}for(var s=0,o=0,f=0;f<n.length;f++){var v=n[f];if(v.some(function(m){var p,c=((p=r[m.id])===null||p===void 0?void 0:p.data)||[];return c.length===0}))o++,s++;else{if(a(f))continue;o++,f<=t&&s++}}this.pagination=(0,V.Z)((0,V.Z)({},this.pagination),{},{current:s,pageSize:o,currentIndex:t})}},{key:"highlightJs",value:function(){document.querySelectorAll(".ql-syntax").forEach(function(r){})}},{key:"validate",value:function(){var e=(0,N.Z)((0,Z.Z)().mark(function i(n){var t,a;return(0,Z.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(a=((t=this.questionsGroupByPagination[n])===null||t===void 0?void 0:t.reduce(function(f,v){return f.push.apply(f,(0,j.Z)((0,$.Xn)(v))),f},[]))||[],a.length!==0){o.next=3;break}return o.abrupt("return",!0);case 3:return o.abrupt("return",this.form.validate("*(".concat(a.map(function(f){return f.id}).join(","),")")));case 4:case"end":return o.stop()}},i,this)}));function r(i){return e.apply(this,arguments)}return r}()},{key:"setVisible",value:function(r){var i=this;if(this.props.paginationVisible===!1)return!1;var n=this.pagination,t=n.currentIndex,a=n.paginationNodes,s=this.form.fields,o=r===void 0?t:r;function f(M){return a[M].every(function(w){var S,D=((S=s[w.id])===null||S===void 0?void 0:S.data)||[];return D.some(function(L){return L==="self_display"||L.startsWith("rule_")})})}if(r!==void 0){if(r===t+1){var v=f(r);if(v){this.pagination.currentIndex=t+1,this.setVisible(r+1);return}}else if(r===t-1){var m=f(r);if(m){this.pagination.currentIndex=t-1,this.setVisible(r-1);return}}}if(this.lazy){var p;this.visibleId&&(s[this.visibleId].display="hidden");var c=a[o];c==null||c.forEach(function(M){s[M.id].display="visible",i.visibleId=M.id});var g=(p=a[o+1])===null||p===void 0?void 0:p[0].id;if(g){var h,d;(h=this.form)===null||h===void 0||(d=h.query(g).take())===null||d===void 0||d.setComponentProps({preload:!0})}this.compute()}else for(var x=0;x<a.length;x++){var P=a[x];x===o?P==null||P.forEach(function(M){var w=s[M.id].data;s[M.id].data=w.filter(function(S){return S!=="hidden"})}):P.forEach(function(M){var w=s[M.id].data;w.includes("hidden")||(s[M.id].data=[].concat((0,j.Z)(w),["hidden"]))})}this.pagination.currentIndex=o}},{key:"handlePrev",value:function(){var r=this.pagination.currentIndex;this.setVisible(r-1)}},{key:"handleNext",value:function(){var e=(0,N.Z)((0,Z.Z)().mark(function i(n){var t;return(0,Z.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t=this.pagination.currentIndex,s.prev=1,s.next=4,this.validate(t);case 4:this.setVisible(t+1),setTimeout(function(){return window.scroll({top:0})},10),s.next=11;break;case 8:s.prev=8,s.t0=s.catch(1),console.log(s.t0);case 11:case"end":return s.stop()}},i,this,[[1,8]])}));function r(i){return e.apply(this,arguments)}return r}()},{key:"getPageIndexByQid",value:function(r){return this.lazy?this.questionsGroupByPagination.findIndex(function(i){return i[0].id===r}):this.questionsGroupByPagination.findIndex(function(i){return!!(i.reduce(function(n,t){return n.push.apply(n,(0,j.Z)((0,$.Xn)(t))),n},[])||[]).find(function(n){return n.id===r})})}},{key:"changePageIndex",value:function(r){var i=this.getPageIndexByQid(r);i!==-1&&(this.setVisible(i),(0,$.lA)(r,this.props.progressBar?-25:0))}},{key:"handleFormValuesChange",value:function(){var e=(0,N.Z)((0,Z.Z)().mark(function i(){return(0,Z.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.computeProgress(),this.props.onChange&&this.props.onChange(this.form.values,this.progress);case 2:case"end":return t.stop()}},i,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"handleFieldValueChange",value:function(){var e=(0,N.Z)((0,Z.Z)().mark(function i(n,t){var a,s,o;return(0,Z.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:o=n.path.toString(),(a=(s=this.props).onFieldChange)===null||a===void 0||a.call(s,o,(0,y.ZN)(n.value)),this.props.exerciseMode&&this.computeReviewAnswer(n.componentProps.schema,n.value);case 3:case"end":return v.stop()}},i,this)}));function r(i,n){return e.apply(this,arguments)}return r}()},{key:"computeReviewAnswer",value:function(){var e=(0,N.Z)((0,Z.Z)().mark(function i(n,t){var a,s,o,f,v,m,p,c;return(0,Z.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(a=!1,this.props.mode!=="exam"){h.next=12;break}if(o=this.reviewAnswer[n.id]||{},f=n.type,["FillBlank","MultipleBlank","HorzBlank","Radio","Checkbox","Judge"].includes(n.type)){h.next=6;break}return h.abrupt("return");case 6:if((f==="Radio"||f==="Judge")&&(o.visible=!0),(s=n.attribute)!==null&&s!==void 0&&s.examAnswerMode&&["selectAll","selectCorrect","onlyOne","select"].includes(n.attribute.examAnswerMode)){h.next=9;break}return h.abrupt("return");case 9:a=!0,this.reviewAnswer[n.id]=n.children.reduce(function(d,x){var P,M=!!((P=x.attribute)!==null&&P!==void 0&&P.examCorrectAnswer);if(f==="FillBlank"||f==="MultipleBlank"||f==="Textarea"||f==="HorzBlank"){var w,S,D=(w=x.attribute)===null||w===void 0?void 0:w.examMatchRule,L=t==null?void 0:t[x.id],J=(S=x.attribute)===null||S===void 0?void 0:S.examCorrectAnswer;!L||!J?M=!1:D==="contain"&&L.includes(J.trim())||L===J?M=!0:M=!1}return d[x.id]={selected:!!(t!=null&&t.hasOwnProperty(x.id)),isCorrect:M},d},{visible:!!(o!=null&&o.visible)}),this.autoNextPage===1&&(v=this.reviewAnswer[n.id],m=v.visible,p=(0,_.Z)(v,fe),c=Object.values(p).filter(function(d){return d.selected&&d.isCorrect}).length===1,c&&(f==="Radio"||f==="Judge")&&this.handleNext());case 12:return h.abrupt("return",a);case 13:case"end":return h.stop()}},i,this)}));function r(i,n){return e.apply(this,arguments)}return r}()},{key:"computeProgress",value:function(){var r=this;if(!!this.props.progressBar){var i=0,n=0;if(this.lazy){var t;i=((t=this.schema.children)===null||t===void 0?void 0:t.length)||1,n=Object.keys(this.form.values).length,this.progress=n/i;return}this.form.query("*").forEach(function(a){var s=r.answerSheet.find(function(o){return o.id===a.path.toString()});a.displayName==="Field"&&!a.path.toString().startsWith("_")&&(s&&(s.display=a.display),a.data.filter(function(o){return o!=="hidden"}).length===0&&i++,!(0,$.xb)(a.value)&&a.componentProps.schema.attribute.display!=="hidden"?(n++,s&&(s.finished=!0)):s&&(s.finished=!1))}),this.progress=n/i}}},{key:"reOrder",value:function(){var r,i=this,n=1;(r=this.schema.children)===null||r===void 0||r.filter(function(t){var a;return(!(0,$.nj)(t.type)||t.type==="QuestionSet")&&((a=t.attribute)===null||a===void 0?void 0:a.examAnswerMode)!=="none"}).forEach(function(t){var a,s=t.id,o=i.form.query(s).get("display");if(o!=="none"&&((a=t.attribute)===null||a===void 0?void 0:a.display)!=="hidden"){var f=i.form.query(s).take();f&&(f.setDecoratorProps((0,V.Z)((0,V.Z)({},f.decoratorProps),{},{seqNo:n})),n++);var v=1;if(t.type==="QuestionSet"){var m;(m=t.children)===null||m===void 0||m.filter(function(p){return!(0,$.nj)(p.type)}).forEach(function(p){var c=p.id,g=i.form.query(c).get("display");if(g==="visible"){var h=i.form.query(c).take();h&&(h.setDecoratorProps((0,V.Z)((0,V.Z)({},h.decoratorProps),{},{seqNo:v})),v++)}})}}})}},{key:"submit",value:function(){var e=(0,N.Z)((0,Z.Z)().mark(function i(){var n,t,a,s,o,f,v,m,p,c,g;return(0,Z.Z)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:n="",t=this.form.query("*").map().filter(function(x){return!(0,R.JF)(x)}),a=(0,q.Z)(t),d.prev=3,a.s();case 5:if((s=a.n()).done){d.next=31;break}if(m=s.value,!(0,R.JF)(m)){d.next=9;break}return d.abrupt("continue",29);case 9:if(n=m.path.toString(),p=((o=this.props.schema.children)===null||o===void 0||(f=o.find(function(x){return x.id===n}))===null||f===void 0||(v=f.attribute)===null||v===void 0?void 0:v.display)==="hidden",!p){d.next=13;break}return d.abrupt("continue",29);case 13:if(c=m.display,c!=="none"){d.next=16;break}return d.abrupt("continue",29);case 16:return g=m.selfDisplay,m.display="visible",d.prev=18,d.next=21,m.validate();case 21:m.display=g,d.next=29;break;case 24:return d.prev=24,d.t0=d.catch(18),this.changePageIndex(n),(0,$.lA)(n,this.props.progressBar?-25:0),d.abrupt("return");case 29:d.next=5;break;case 31:d.next=36;break;case 33:d.prev=33,d.t1=d.catch(3),a.e(d.t1);case 36:return d.prev=36,a.f(),d.finish(36);case 39:return this.props.onSubmit&&this.props.onSubmit((0,y.ZN)(this.form.values)),d.abrupt("return",{values:(0,y.ZN)(this.form.values)});case 41:case"end":return d.stop()}},i,this,[[3,33,36,39],[18,24]])}));function r(){return e.apply(this,arguments)}return r}()},{key:"markQuestion",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this.answerSheet,t=n.findIndex(function(a){return a.id===r});this.answerSheet.splice(t,1,(0,V.Z)((0,V.Z)({},n[t]),{},{marked:i}))}},{key:"favoriteQuestion",value:function(r){var i=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this.answerSheet,a=t.findIndex(function(s){return s.id===r.templateId});n?ee.hi.createUserBook((0,V.Z)((0,V.Z)({},r),{},{type:2})).then(function(s){s.success&&i.answerSheet.splice(a,1,(0,V.Z)((0,V.Z)({},t[a]),{},{favorite:n}))}):ee.hi.deleteUserBook((0,V.Z)((0,V.Z)({},r),{},{type:2})).then(function(s){s.success&&i.answerSheet.splice(a,1,(0,V.Z)((0,V.Z)({},t[a]),{},{favorite:n}))})}},{key:"cleanup",value:function(){this.unmount=!0}}]),l}();function ce(l,e,r){var i=void 0,n=void 0;return function(){var t=+new Date;n||(n=t),r&&t-n>r?(l(),n=t,window.clearTimeout(i)):(window.clearTimeout(i),i=window.setTimeout(function(){l(),n=void 0},e))}}var ie=u(99439),he=u(27484),me=u.n(he),ge=u(90019),G=u(10192),pe=u(76826),ye=u(29371),ne=u(44335),be=function(){try{return(0,ne.lw)()}catch(e){return null}},xe=function(e,r){return!e||!r?e:Object.keys(r).reduce(function(i,n){var t;return i.replace(new RegExp("\\{".concat(n,"\\}"),"g"),"".concat((t=r[n])!==null&&t!==void 0?t:""))},e)},b=function(e,r,i){var n=be();if(n&&typeof n.formatMessage=="function")try{return n.formatMessage({id:e,defaultMessage:r},i)}catch(t){}return xe(r,i)},Ve=function(){try{return(0,ne.Kd)()}catch(e){return}},Me=function(){var e,r=((e=Ve())===null||e===void 0?void 0:e.toLowerCase())||"";return r.startsWith("zh")?"\uFF0C":", "};function Oe(l,e){var r,i,n=e.id,t=[];if((r=e.parent)!==null&&r!==void 0&&(i=r.type)!==null&&i!==void 0&&i.startsWith("Matrix"))if(e.parent.type==="MatrixAuto"&&Array.isArray(l))l.forEach(function(f,v){t.push(["".concat(v,"-").concat(n),f[e.id]])});else{var a;(a=e.parent.row)===null||a===void 0||a.forEach(function(f){l[f.id]?t.push(["".concat(f.id,"-").concat(n),l[f.id][e.id]]):t.push(["".concat(f.id,"-").concat(n),void 0])})}else{var s,o=(s=e.parent)===null||s===void 0?void 0:s.type;o==="Radio"||o==="Checkbox"?Object.keys(l).includes(e.id)&&t.push([e.id,l[e.id]]):t.push([e.id,l[e.id]])}return t}function re(l){return!isNaN(parseFloat(l))&&isFinite(l)}function $e(l){return!!(re(l)&&Number.isInteger(parseFloat(l)))}function E(l){var e=l.errMsg,r=l.schema,i=l.regEx,n=l.value;return r?I({schema:r,value:n,errMsg:e,isValid:function(a){return a?i.test("".concat(a)):!0}}):null}function Pe(l){var e,r=l.schema,i=l.value,n=l.errMsg,t=((e=r.children)===null||e===void 0?void 0:e.filter(function(f){var v;return(v=f.attribute)===null||v===void 0?void 0:v.exclusiveFillBlankInMatrix}))||[],a=JSON.parse(JSON.stringify(i));Object.values(a).forEach(function(f){t.map(function(v){return v.id}).forEach(function(v){delete f[v]})});var s=!1;if(r.type==="MatrixAuto")i&&i.length>0&&(s=!0);else{var o;s=(o=r.row)===null||o===void 0?void 0:o.every(function(f){var v=a[f.id];return!(0,$.xb)(v)})}return s?null:n}function I(l){var e=l.value,r=l.schema,i=l.isValid,n=l.errMsg;return!r||!r.parent?null:Oe(e,r).map(function(t){var a=(0,te.Z)(t,2),s=a[0],o=a[1];return i(o)?null:"".concat(s,"^").concat(n)}).filter(function(t){return t})[0]}function Te(l){if(Object.keys(l).length===0)return!0}function Ze(l){var e=l.substring(6,8),r=l.substring(8,10),i=l.substring(10,12),n=new Date(parseFloat(e),parseFloat(r)-1,parseFloat(i));return!(n.getFullYear()-1900!==parseFloat(e)||n.getMonth()!==parseFloat(r)-1||n.getDate()!==parseFloat(i))}function we(l){var e=l;if(l.length!==15&&l.length!==18)return!1;if(l.length===15)return Ze(e);var r={11:"\u5317\u4EAC",12:"\u5929\u6D25",13:"\u6CB3\u5317",14:"\u5C71\u897F",15:"\u5185\u8499\u53E4",21:"\u8FBD\u5B81",22:"\u5409\u6797",23:"\u9ED1\u9F99\u6C5F ",31:"\u4E0A\u6D77",32:"\u6C5F\u82CF",33:"\u6D59\u6C5F",34:"\u5B89\u5FBD",35:"\u798F\u5EFA",36:"\u6C5F\u897F",37:"\u5C71\u4E1C",41:"\u6CB3\u5357",42:"\u6E56\u5317 ",43:"\u6E56\u5357",44:"\u5E7F\u4E1C",45:"\u5E7F\u897F",46:"\u6D77\u5357",50:"\u91CD\u5E86",51:"\u56DB\u5DDD",52:"\u8D35\u5DDE",53:"\u4E91\u5357",54:"\u897F\u85CF ",61:"\u9655\u897F",62:"\u7518\u8083",63:"\u9752\u6D77",64:"\u5B81\u590F",65:"\u65B0\u7586",71:"\u53F0\u6E7E",81:"\u9999\u6E2F",82:"\u6FB3\u95E8",91:"\u56FD\u5916 "},i=!0;if(!e||!/^([1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx])|([1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2})$/i.test(e))i=!1;else if(!r[e.substr(0,2)])i=!1;else if(e.length>18)i=!1;else if(e.length===18){for(var n=e.split(""),t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],a=[1,0,"X",9,8,7,6,5,4,3,2],s=0,o=0,f=0,v=0;v<17;v+=1)o=parseInt(n[v],10),f=t[v],s+=o*f;var m=n[17].toUpperCase()==="X"?"X":Number(n[17]);a[s%11]!==m&&(i=!1)}return i}function A(l,e){var r,i,n;return!l||!e?!0:((r=e.parent)===null||r===void 0?void 0:r.type)==="MatrixAuto"?l.every(function(t){return(0,$.xb)(t[e.id])}):(i=e.parent)!==null&&i!==void 0&&(n=i.type)!==null&&n!==void 0&&n.startsWith("Matrix")?Object.values(l).every(function(t){return(0,$.xb)(t[e.id])}):!!(0,$.xb)(l[e.id])}var Se={required:function(e,r){var i,n,t=r.schema,a=r.theme,s=r.survey;if(r&&r.required===!1)return null;if((0,$.xb)(e)){var o;return a==="antdForm"?b("pages.answer.validation.input","\u8BF7\u8F93\u5165"):(s==null||(o=s.attribute)===null||o===void 0?void 0:o.validateMsgQuestionRequired)||b("pages.answer.validation.questionRequired","\u8FD9\u9053\u9898\u672A\u56DE\u7B54")}return t!=null&&(i=t.type)!==null&&i!==void 0&&i.startsWith("Matrix")?Pe({schema:t,errMsg:b("pages.answer.validation.matrixIncomplete","\u95EE\u9898\u672A\u56DE\u7B54\u5B8C\u6574"),value:e}):t!=null&&t.parent?I({schema:t,value:e,errMsg:(s==null||(n=s.attribute)===null||n===void 0?void 0:n.validateMsgOptionRequired)||b("pages.answer.validation.optionRequired","\u8FD9\u4E2A\u9009\u9879\u672A\u56DE\u7B54"),isValid:function(v){var m,p,c,g,h,d;return(t==null||(m=t.parent)===null||m===void 0?void 0:m.type)==="MatrixAuto"?!(!(0,ye.H1)(e)&&(0,$.xb)(e[t.id])):t!=null&&(p=t.parent)!==null&&p!==void 0&&(c=p.type)!==null&&c!==void 0&&c.startsWith("Matrix")&&t!==null&&t!==void 0&&(g=t.attribute)!==null&&g!==void 0&&g.dataType?typeof v!="boolean":(0,pe.Kn)(t)&&t!==null&&t!==void 0&&(h=t.attribute)!==null&&h!==void 0&&h.dataType&&(t==null||(d=t.attribute)===null||d===void 0?void 0:d.dataType)!=="select"&&e[t.id]===!0?!1:!(0,$.xb)(v)}}):null},text:function(e,r){var i,n,t,a=r.schema;if(A(e,a))return null;var s=(i=r.schema)===null||i===void 0||(n=i.attribute)===null||n===void 0?void 0:n.regexp;return s==null||(t=s.map(function(o){return I({errMsg:o.message,schema:a,value:e,isValid:function(v){return v!==void 0&&typeof v=="string"?new RegExp(o.expression).test(v):!0}})}).filter(function(o){return!!o}))===null||t===void 0?void 0:t[0]},answerLimit:function(e,r){var i,n=r.schema,t=n==null||(i=n.attribute)===null||i===void 0?void 0:i.answerLimit;if(!t)return null;var a=t.slice(1,t.length-1).split(","),s=parseInt(a[0]||"0"),o=parseInt(a[1]||"0"),f=Object.keys(e||{}).length;return e&&(f<s&&s!==0||f>o&&o!==0)?s===0?b("pages.answer.validation.selectMax","\u6700\u591A\u9009\u62E9{count}\u9879",{count:o}):o===0?b("pages.answer.validation.selectMin","\u6700\u5C11\u9009\u62E9{count}\u9879",{count:s}):b("pages.answer.validation.selectRange","\u6700\u5C11\u9009\u62E9{min}\u9879,\u6700\u591A\u9009\u62E9{max}\u9879",{min:s,max:o}):null},number:function(e,r){var i,n=r.schema;if(A(e,n))return null;var t=n==null||(i=n.attribute)===null||i===void 0?void 0:i.numericScale,a=b("pages.answer.validation.number","\u8BF7\u8F93\u5165\u6570\u5B57");return t===0?a=b("pages.answer.validation.integer","\u8BF7\u8F93\u5165\u6574\u6570"):t&&t>0&&(a=b("pages.answer.validation.decimalPrecision","\u8BF7\u4FDD\u7559{count}\u4F4D\u5C0F\u6570",{count:t})),I({errMsg:a,schema:n,value:e,isValid:function(o){return!(o!==void 0&&(!re(o)||t===0&&!$e(o)||t!==void 0&&t>0&&("".concat(o).split(".")[1]||"").length>t))}})},date:function(e,r){var i,n=r.schema;if(A(e,n))return null;if(n!=null&&(i=n.attribute)!==null&&i!==void 0&&i.dateTimeFormat&&e&&e[n.id]){var t=me()(e[n.id],n.attribute.dateTimeFormat).isValid();return t?null:b("pages.answer.validation.dateFormat","\u65E5\u671F\u683C\u5F0F\u4E0D\u6B63\u786E")}return E({errMsg:b("pages.answer.validation.date","\u8BF7\u8F93\u5165\u65E5\u671F"),schema:n,regEx:/^(?:(?:1[6-9]|[2-9][0-9])[0-9]{2}([-/.]?)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:(?:1[6-9]|[2-9][0-9])(?:0[48]|[2468][048]|[13579][26])|(?:16|[2468][048]|[3579][26])00)([-/.]?)0?2\2(?:29))(\s+([01][0-9]:|2[0-3]:)?[0-5][0-9]:[0-5][0-9])?$/,value:e})},dateTime:function(e,r){var i=r.schema;return A(e,i)?null:E({errMsg:b("pages.answer.validation.dateTime","\u8BF7\u8F93\u5165\u65E5\u671F\u65F6\u95F4"),schema:i,regEx:/^\d{4}[-]([0][1-9]|(1[0-2]))[-]([1-9]|([012]\d)|(3[01]))\s(([0-1]{1}[0-9]{1})|([2]{1}[0-4]{1}))([:])(([0-5]{1}[0-9]{1}|[6]{1}[0]{1}))([:])((([0-5]{1}[0-9]{1}|[6]{1}[0]{1})))$/,value:e})},time:function(e,r){var i=r.schema;return A(e,i)?null:E({errMsg:b("pages.answer.validation.time","\u8BF7\u8F93\u5165\u65F6\u95F4"),schema:i,regEx:/^(([0-1]{1}[0-9]{1})|([2]{1}[0-4]{1}))([:])(([0-5]{1}[0-9]{1}|[6]{1}[0]{1}))([:])((([0-5]{1}[0-9]{1}|[6]{1}[0]{1})))$/,value:e})},mobile:function(e,r){var i=r.schema;return A(e,i)||e[i.id]===!0?null:E({errMsg:b("pages.answer.validation.mobile","\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"),schema:i,regEx:/^1[0-9]{10}$/,value:e})},decimal:function(e,r){var i=r.schema;return A(e,i)?null:E({errMsg:b("pages.answer.validation.number","\u8BF7\u8F93\u5165\u6570\u5B57"),schema:i,regEx:/^[+-]?\d+(\.\d+)?$/,value:e})},email:function(e,r){var i=r.schema;return A(e,i)?null:E({errMsg:b("pages.answer.validation.email","\u90AE\u4EF6\u683C\u5F0F\u4E0D\u6B63\u786E"),schema:i,regEx:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,value:e})},idCard:function(e,r){var i=r.schema;return A(e,i)?null:I({errMsg:b("pages.answer.validation.idCard","\u8EAB\u4EFD\u8BC1\u683C\u5F0F\u4E0D\u6B63\u786E"),schema:i,value:e,isValid:function(t){return!(t&&!we("".concat(t)))}})},chinese:function(e,r){var i=r.schema;return A(e,i)?null:E({errMsg:b("pages.answer.validation.chinese","\u8BF7\u8F93\u5165\u6C49\u5B57"),schema:i,regEx:/^[\u4e00-\u9fa5]+$/,value:e})},alphabet:function(e,r){var i=r.schema;return A(e,i)?null:E({errMsg:b("pages.answer.validation.alphabet","\u8BF7\u8F93\u5165\u5B57\u6BCD"),schema:i,regEx:/^[a-zA-Z]+$/,value:e})},textLimit:function(e,r){var i,n=r.schema;if(A(e,n))return null;var t=n==null||(i=n.attribute)===null||i===void 0?void 0:i.textLimit;if(!t)return null;var a=t.slice(1,t.length-1).split(","),s=parseInt(a[0]||"0"),o=parseInt(a[1]||"0");if(s===0&&o===0)return null;var f=I({errMsg:s!==o?b("pages.answer.validation.textLimitRange","\u8BF7\u8F93\u5165{min}~{max}\u4E2A\u5B57",{min:s,max:o}):b("pages.answer.validation.textLimitExact","\u8BF7\u8F93\u5165{count}\u4E2A\u5B57",{count:s}),schema:n,value:e,isValid:function(m){return!(m&&("".concat(m).length<s||"".concat(m).length>o))}});return f},scope:function(e,r){var i,n,t,a=r.schema;if(A(e,a))return null;var s=a==null||(i=a.attribute)===null||i===void 0?void 0:i.scope,o=a==null||(n=a.attribute)===null||n===void 0?void 0:n.dataType;if(s&&o){if(o==="number")return I({errMsg:b("pages.answer.validation.numberScope","\u6570\u503C\u8303\u56F4\u4E0D\u6B63\u786E {scope}",{scope:s}),schema:a,value:e,isValid:function(d){return!(d!==void 0&&!(0,G.$l)(s,"".concat(d)))}});if(o==="date")return I({errMsg:b("pages.answer.validation.dateScope","\u65E5\u671F\u8303\u56F4\u4E0D\u6B63\u786E {scope}",{scope:s}),schema:a,value:e,isValid:function(d){return!(d&&!(0,G.sm)(s,"".concat(d)))}});if(o==="dateTime")return I({errMsg:b("pages.answer.validation.dateTimeScope","\u65E5\u671F\u65F6\u95F4\u8303\u56F4\u4E0D\u6B63\u786E {scope}",{scope:s}),schema:a,value:e,isValid:function(d){return!(d&&!(0,G.de)(s,"".concat(d)))}});if(o==="time")return I({errMsg:b("pages.answer.validation.timeScope","\u65F6\u95F4\u8303\u56F4\u4E0D\u6B63\u786E {scope}",{scope:s}),schema:a,value:e,isValid:function(d){return!(d&&!(0,G.YM)(s,"".concat(d)))}})}else if((a==null?void 0:a.type)==="MatrixAuto"&&(t=a.attribute)!==null&&t!==void 0&&t.scope){var f,v=(f=a.attribute)===null||f===void 0?void 0:f.scope,m=(0,G.$l)(v,"".concat(Object.keys(e).length));if(m)return null;var p=v.substring(1,v.indexOf(",")),c=v.substring(v.indexOf(",")+1,v.length-1),g=[];return p&&g.push(b("pages.answer.validation.matrixMinRows","\u6700\u5C11{count}\u884C",{count:p})),c&&g.push(b("pages.answer.validation.matrixMaxRows","\u6700\u591A{count}\u884C",{count:c})),g.join(Me())}return null},horzBlank:function(e,r){return(0,N.Z)((0,Z.Z)().mark(function i(){var n,t,a,s,o,f,v,m;return(0,Z.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(t=r.schema,e){c.next=3;break}return c.abrupt("return",null);case 3:if(!((t==null||(n=t.attribute)===null||n===void 0?void 0:n.dataType)!=="horzBlank"||e[t.id]===void 0||!t.children||!t.parent)){c.next=5;break}return c.abrupt("return",null);case 5:a=null,s=0;case 7:if(!(s<((o=t.children)===null||o===void 0?void 0:o.length))){c.next=17;break}return f=t.children[s],v=(0,ge.j)(f,t),c.next=12,(0,ie.Gu)(e[t.id],v,{validateFirst:!0});case 12:m=c.sent,m.error&&m.error.length>0&&(a=m.error[0]);case 14:s++,c.next=7;break;case 17:return c.abrupt("return",a);case 18:case"end":return c.stop()}},i)}))()}};(0,ie.au)(Se);var Ae=u(8166),ae=u(8373),B=u(85893);window.katex=Ae.Z;var se=(0,O.forwardRef)(function(l,e){var r=l.theme,i=r===void 0?k.uH:r,n=l.footerVisible,t=n===void 0?!0:n,a=l.headerVisible,s=a===void 0?!0:a,o=l.loading,f=l.questionNumber,v=f===void 0?!0:f,m=l.onUpload,p=l.progressBar,c=p===void 0?!1:p,g=l.statistics,h=l.isPreview,d=l.mode,x=d===void 0?"survey":d,P=l.correctAnswerVisible,M=P===void 0?!1:P,w=l.examScoreVisible,S=w===void 0?!1:w,D=l.requiredVisible,L=D===void 0?!0:D,J=l.onDictSearch,Ie=l.onLink,Ce=l.triggerType,H=(0,O.useMemo)(function(){return new ve(l)},[]),F=H.form,z=(0,O.useMemo)(function(){return(0,$.Gt)(l.schema)},[l.schema]),Ee=(0,O.useMemo)(function(){var C={},T=function U(Q){C[Q.id]=Q.title,Q.children&&Q.children.forEach(U)};return T(z),document.title=(0,ee.WO)(z.title),C},[z]),Le=(0,O.useMemo)(function(){return(0,$.R6)(l.schema)},[l.schema]);(0,O.useImperativeHandle)(e,function(){return{submit:function(){return H.submit()},reset:function(){F.reset()},setValues:function(T){F.setValues(T,"overwrite")},setValue:function(T,U){F.setFieldState(T,function(Q){return Q.value=U})},toggleReadOnly:function(T){F.setState(function(U){U.pattern=T?"readPretty":"editable"})},getValues:function(){return F.values},getStore:function(){return H}}}),(0,O.useEffect)(function(){l.onInit&&l.onInit(F)},[]);var Fe=(0,O.useMemo)(function(){return{theme:i,schema:z,footerVisible:t,questionNumber:v,headerVisible:s,optionTypes:Le,onUpload:m,loading:o,id2title:Ee,progressBar:c,innerStore:H,statistics:g,isPreview:h,mode:x,correctAnswerVisible:M,examScoreVisible:S,onDictSearch:J,requiredVisible:L,onLink:Ie,triggerType:Ce}},[o,z,g]);return(0,B.jsx)(O.Suspense,{fallback:(0,B.jsx)(ae.gb,{}),children:(0,B.jsx)(ae.ZP,{theme:i,children:(0,B.jsx)(W.RV,{form:F,children:(0,B.jsx)(Y.Z.Provider,{value:Fe,children:(0,B.jsx)(K.k9,{schema:z})})})})})}),Ne=se},8373:function(le,X,u){"use strict";u.d(X,{gb:function(){return q}});var W=u(67294),O=u(85893),K=W.lazy(function(){return Promise.all([u.e(2225),u.e(9223),u.e(4968),u.e(7115),u.e(7422),u.e(9278),u.e(701),u.e(3305),u.e(5362),u.e(9228),u.e(4839),u.e(1818),u.e(9454),u.e(3524),u.e(4512),u.e(1476),u.e(780),u.e(1044),u.e(6131),u.e(1702),u.e(1004)]).then(u.bind(u,6465))}),Y=W.lazy(function(){return Promise.all([u.e(2225),u.e(9223),u.e(4968),u.e(7098),u.e(7115),u.e(7422),u.e(9278),u.e(5246),u.e(701),u.e(3305),u.e(9228),u.e(4839),u.e(1818),u.e(5555),u.e(9454),u.e(4512),u.e(780),u.e(7707),u.e(1044),u.e(5761),u.e(8851),u.e(3428)]).then(u.bind(u,61616))}),k=W.lazy(function(){return Promise.all([u.e(9223),u.e(7115),u.e(9278),u.e(5246),u.e(5362),u.e(4839),u.e(1044),u.e(6713),u.e(2944)]).then(u.bind(u,17707))}),q=function(){return(0,O.jsx)("div",{className:"page-loading-warp",children:(0,O.jsxs)("div",{className:"spinner",children:[(0,O.jsx)("div",{className:"rect1"}),(0,O.jsx)("div",{className:"rect2"}),(0,O.jsx)("div",{className:"rect3"}),(0,O.jsx)("div",{className:"rect4"}),(0,O.jsx)("div",{className:"rect5"})]})})},_=function(j){var N=j.theme,V=j.children;return N==="antdMobile"?(0,O.jsx)(Y,{children:V}):N==="antdForm"?(0,O.jsx)(k,{children:V}):(0,O.jsx)(K,{children:V})};X.ZP=_}}]);
