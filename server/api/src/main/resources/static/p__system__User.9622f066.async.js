(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[7915],{86468:function(De,se,e){"use strict";e.d(se,{lq:function(){return ue},FQ:function(){return de},fl:function(){return V}});var Ie=e(43358),re=e(34041),ne=e(20228),W=e(11382),A=e(11849),k=e(94657),B=e(93224),N=e(3980),ae=e(21307),K=e(67294),P=e(85893),le=["fps","fetcher","width","className","defaultOptions","readonly","value"],ue=function(i){var q=i.fps,Z=q===void 0?30:q,G=i.fetcher,f=i.width,T=i.className,u=i.defaultOptions,b=i.readonly,D=i.value,l=(0,B.Z)(i,le),h=(0,K.useState)(!1),E=(0,k.Z)(h,2),d=E[0],a=E[1],H=(0,K.useState)(u||[]),F=(0,k.Z)(H,2),U=F[0],O=F[1],p=K.useRef(0),z=V(f),j=(0,N.zE)(function(o){a(!0),O([]),p.current+=1;var L=p.current;i.fetcher(o).then(function(ge){L===p.current&&(O(ge),a(!1))})},Z);if(b){var I;return(0,P.jsx)(ae.ZP.Item,(0,A.Z)((0,A.Z)({},l),{},{children:(0,P.jsx)("span",{children:(I=U.find(function(o){return o.value===D}))===null||I===void 0?void 0:I.label})}))}return(0,P.jsx)(ae.ZP.Item,(0,A.Z)((0,A.Z)({},l),{},{children:(0,P.jsx)(re.Z,(0,A.Z)({showSearch:!0,placeholder:i.placeholder,filterOption:!1,onSearch:j,allowClear:!0,onFocus:function(){return j("")},onClear:function(){return j("")},loading:d,notFoundContent:d?(0,P.jsx)(W.Z,{size:"small"}):null,options:U},z))}))},me=e(62999),fe=e(54680),S=["width","className","treeData","placeholder","readonly","value"],de=function(i){var q=i.width,Z=i.className,G=i.treeData,f=i.placeholder,T=i.readonly,u=i.value,b=(0,B.Z)(i,S),D=V(q);if(T){var l;return(0,P.jsx)(ae.ZP.Item,(0,A.Z)((0,A.Z)({},b),{},{children:(0,P.jsx)("span",{children:(l=(0,N.hE)(G,u,"key"))===null||l===void 0?void 0:l.title})}))}return(0,P.jsx)(ae.ZP.Item,(0,A.Z)((0,A.Z)({},b),{},{children:(0,P.jsx)(fe.Z,(0,A.Z)({dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:G,placeholder:f,treeDefaultExpandAll:!0},D))}))};function V(R){if(!R)return{};if(typeof R=="number")return{style:{width:R}};if(typeof R=="string")return{className:"pro-field ".concat(typeof R=="string"?"pro-field-".concat(R):"")}}},79871:function(De,se,e){"use strict";e.d(se,{G:function(){return b},y:function(){return u}});var Ie=e(57663),re=e(71577),ne=e(39428),W=e(3182),A=e(34792),k=e(48086),B=e(71194),N=e(50146),ae=e(94657),K=e(83279),P=e(3980),le=e(87588),ue=e(51042),me=e(16894),fe=e(9761),S=e(60780),de=e.n(S),V=e(67294),R=e(42285),i=e(11849),q=e(86468),Z=e(21307),G=e(80582),f=e(85893),T=(0,G.Pi)(function(D){var l=D.dept,h=D.onClose,E=D.onOk,d=(0,P.m2)(),a=(0,R.YB)(),H=(0,V.useRef)(),F=!!(l!=null&&l.id),U=d.depts,O=(0,V.useMemo)(function(){return de()(U.map(function(p){return{value:p.id,title:p.name,key:p.id,parentId:p.parentId}}),{parentProperty:"parentId",customID:"value"})},[U]);return(0,f.jsxs)(Z.aN,{title:F?a.formatMessage({id:"pages.system.dept.drawer.edit",defaultMessage:"\u4FEE\u6539\u7EC4\u7EC7\u673A\u6784"}):a.formatMessage({id:"pages.system.dept.drawer.create",defaultMessage:"\u65B0\u5EFA\u7EC4\u7EC7\u673A\u6784"}),formRef:H,initialValues:(0,i.Z)({},l),visible:!0,drawerProps:{forceRender:!0,destroyOnClose:!0,onClose:function(){h()}},onFinish:function(){var p=(0,W.Z)((0,ne.Z)().mark(function z(j){var I;return(0,ne.Z)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,d.saveOrUpdateDept((0,i.Z)((0,i.Z)({},l),j));case 2:I=L.sent,I.success?E():k.default.error(a.formatMessage({id:"pages.system.dept.message.saveFailed",defaultMessage:"\u4FDD\u5B58\u5931\u8D25"}));case 4:case"end":return L.stop()}},z)}));return function(z){return p.apply(this,arguments)}}(),children:[(0,f.jsxs)(Z.ZP.Group,{children:[(!l||l&&l.id!=="1")&&U.length>0&&(0,f.jsx)(q.FQ,{name:"parentId",width:"md",treeData:O,label:a.formatMessage({id:"pages.system.dept.field.parent.label",defaultMessage:"\u4E0A\u7EA7\u90E8\u95E8"}),placeholder:a.formatMessage({id:"pages.system.dept.field.parent.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u540D\u79F0"}),required:!0,value:l==null?void 0:l.id,rules:[{required:!0,message:a.formatMessage({id:"pages.system.dept.field.parent.required",defaultMessage:"\u4E0A\u7EA7\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A"})}]}),(0,f.jsx)(Z.V,{name:"code",width:"md",label:a.formatMessage({id:"pages.system.dept.field.code.label",defaultMessage:"\u7F16\u7801"}),placeholder:a.formatMessage({id:"pages.system.dept.field.code.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u7F16\u7801"}),required:!0,rules:[{required:!0,message:a.formatMessage({id:"pages.system.dept.field.code.required",defaultMessage:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A"})}]})]}),(0,f.jsxs)(Z.ZP.Group,{children:[(0,f.jsx)(Z.V,{name:"name",width:"md",label:a.formatMessage({id:"pages.system.dept.field.name.label",defaultMessage:"\u5168\u79F0"}),id:"form-name",placeholder:a.formatMessage({id:"pages.system.dept.field.name.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u5168\u79F0"}),required:!0,rules:[{required:!0,message:a.formatMessage({id:"pages.system.dept.field.name.required",defaultMessage:"\u5168\u79F0\u4E0D\u80FD\u4E3A\u7A7A"})}]}),(0,f.jsx)(Z.V,{name:"shortName",width:"md",label:a.formatMessage({id:"pages.system.dept.field.shortName.label",defaultMessage:"\u7B80\u79F0"}),id:"form-name",placeholder:a.formatMessage({id:"pages.system.dept.field.shortName.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u7B80\u79F0"}),required:!0})]}),(0,f.jsx)(Z.ZP.Group,{children:(0,f.jsx)(q.lq,{fps:2,name:"managerId",width:"md",label:a.formatMessage({id:"pages.system.dept.field.manager.label",defaultMessage:"\u8D1F\u8D23\u4EBA"}),placeholder:a.formatMessage({id:"pages.system.dept.field.manager.placeholder",defaultMessage:"\u8F93\u5165\u59D3\u540D\u68C0\u7D22"}),value:l==null?void 0:l.managerId,defaultOptions:F?[{label:l.managerName,value:l.managerId}]:void 0,fetcher:function(z){return P.hi.loadUsers({name:z}).then(function(j){return j.list.map(function(I){return{label:I.name,value:I.id}})})}})}),(0,f.jsx)(Z.ZP.Group,{children:(0,f.jsx)(Z.$J,{name:"remark",width:690,label:a.formatMessage({id:"pages.system.dept.field.remark.label",defaultMessage:"\u5907\u6CE8"}),id:"form-name",placeholder:a.formatMessage({id:"pages.system.dept.field.remark.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u5907\u6CE8"})})})]})});function u(D,l){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"id",E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!l)return D;for(var d=(0,K.Z)(D);d.length;){var a=d[E?"pop":"shift"]();if(a&&a[h]===l)return[a];a!=null&&a.children&&d.push.apply(d,(0,K.Z)(a.children))}return null}var b=(0,fe.Pi)(function(D){var l=D.selectedDept,h=(0,P.m2)(),E=h.loading,d=(0,R.YB)(),a=(0,V.useRef)(),H=(0,V.useState)({visible:!1}),F=(0,ae.Z)(H,2),U=F[0],O=F[1],p=u(de()(h.depts,{customID:"id",parentProperty:"parentId"}),l),z=[{title:d.formatMessage({id:"pages.system.dept.column.name",defaultMessage:"\u673A\u6784\u540D\u79F0"}),dataIndex:"name"},{title:d.formatMessage({id:"pages.system.dept.column.shortName",defaultMessage:"\u673A\u6784\u7B80\u79F0"}),dataIndex:"shortName",search:!1,width:200},{title:d.formatMessage({id:"pages.system.dept.column.manager",defaultMessage:"\u8D1F\u8D23\u4EBA"}),dataIndex:"managerName",search:!1,width:150},{title:d.formatMessage({id:"pages.system.dept.column.actions",defaultMessage:"\u64CD\u4F5C"}),valueType:"option",render:function(I,o){return[(0,f.jsx)("a",{onClick:function(){return O({visible:!0,current:o})},children:d.formatMessage({id:"pages.common.edit",defaultMessage:"\u7F16\u8F91"})},"edit"),(0,f.jsx)("a",{onClick:function(){if(o.id==="1"){N.Z.info({title:d.formatMessage({id:"pages.system.dept.modal.info.title",defaultMessage:"\u63D0\u793A"}),content:d.formatMessage({id:"pages.system.dept.modal.info.content",defaultMessage:"\u5185\u7F6E\u673A\u6784\u4E0D\u80FD\u5220\u9664"}),okText:d.formatMessage({id:"pages.common.ok",defaultMessage:"\u786E\u5B9A"})});return}if(o.children&&o.children.length>0){k.default.error(d.formatMessage({id:"pages.system.dept.message.deleteChildren",defaultMessage:"\u8BF7\u5148\u5220\u9664\u5B50\u673A\u6784\uFF01"}));return}N.Z.confirm({title:d.formatMessage({id:"pages.system.dept.modal.delete.title",defaultMessage:"\u5220\u9664"}),content:d.formatMessage({id:"pages.system.dept.modal.delete.content",defaultMessage:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u673A\u6784?"}),icon:(0,f.jsx)(le.Z,{}),okText:d.formatMessage({id:"pages.common.delete",defaultMessage:"\u5220\u9664"}),cancelText:d.formatMessage({id:"pages.common.cancel",defaultMessage:"\u53D6\u6D88"}),onOk:function(){h.deleteDept(o.id)}})},children:d.formatMessage({id:"pages.common.delete",defaultMessage:"\u5220\u9664"})},"delete")]}}];return(0,f.jsxs)("div",{children:[(0,f.jsx)(me.ZP,{columns:z,actionRef:a,loading:E,bordered:!0,dataSource:p,request:(0,W.Z)((0,ne.Z)().mark(function j(){return(0,ne.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",h.loadDepts());case 1:case"end":return o.stop()}},j)})),columnsState:{persistenceKey:"pro-table-dept",persistenceType:"localStorage"},rowKey:"id",search:!1,scroll:{x:650},pagination:!1,dateFormatter:"string",headerTitle:d.formatMessage({id:"pages.system.dept.header",defaultMessage:"\u673A\u6784\u7BA1\u7406"}),toolBarRender:function(){return[(0,f.jsx)(re.Z,{icon:(0,f.jsx)(ue.Z,{}),type:"primary",onClick:function(){O({visible:!0})},children:d.formatMessage({id:"pages.common.new",defaultMessage:"\u65B0\u5EFA"})},"button")]}}),U.visible&&(0,f.jsx)(T,{onOk:function(){O({visible:!1})},dept:U.current,readonly:U.readonly,onClose:function(){return O({visible:!1})}})]})})},40017:function(De,se,e){"use strict";e.d(se,{A:function(){return D}});var Ie=e(58024),re=e(91894),ne=e(32157),W=e(38614),A=e(34792),k=e(48086),B=e(49111),N=e(19650),ae=e(22385),K=e(94199),P=e(94657),le=e(83279),ue=e(3980),me=e(81162),fe=e(17828),S=e(59879),de=e(54734),V=e(82029),R=e(55725),i=e(9761),q=e(60780),Z=e.n(q),G=e(67294),f=e(42285),T=e(79871),u=e(85893);function b(l){var h=[];return l.forEach(function(E){E.children&&(h.push(E.key),h.push.apply(h,(0,le.Z)(b(E.children))))}),h}var D=(0,i.Pi)(function(l){var h=(0,ue.m2)(),E=h.depts,d=(0,f.YB)();(0,G.useEffect)(function(){h.loadDepts()},[h]);var a=(0,G.useMemo)(function(){return Z()(E.map(function(w){return{title:w.name,key:w.id,parentId:w.parentId}}),{parentProperty:"parentId",customID:"key"})},[E]),H=(0,G.useState)([]),F=(0,P.Z)(H,2),U=F[0],O=F[1],p=(0,G.useState)(!0),z=(0,P.Z)(p,2),j=z[0],I=z[1],o=(0,G.useMemo)(function(){return b(a)},[a]),L=function(s){O(s),I(!1)},ge=function(s){s.length>0?l.onSelect(s[0]):l.onSelect(void 0)};return(0,u.jsx)(re.Z,{title:d.formatMessage({id:"pages.system.dept.tree.title",defaultMessage:"\u7EC4\u7EC7\u673A\u6784"}),extra:(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(N.Z,{children:[U.length>0?(0,u.jsx)(K.Z,{title:d.formatMessage({id:"pages.system.dept.tree.collapseAll",defaultMessage:"\u6298\u53E0\u6240\u6709"}),children:(0,u.jsx)(me.Z,{style:{cursor:"pointer"},onClick:function(){return O([])}})}):(0,u.jsx)(K.Z,{title:d.formatMessage({id:"pages.system.dept.tree.expandAll",defaultMessage:"\u5C55\u5F00\u6240\u6709"}),children:(0,u.jsx)(fe.Z,{style:{cursor:"pointer"},onClick:function(){return O(o)}})}),(0,u.jsx)(K.Z,{title:d.formatMessage({id:"pages.system.dept.tree.refresh",defaultMessage:"\u5237\u65B0"}),children:(0,u.jsx)(S.Z,{style:{cursor:"pointer"},onClick:function(){return h.loadDepts()}})})]})}),children:(0,u.jsx)(W.Z,{expandedKeys:U,onExpand:L,draggable:!0,autoExpandParent:j,onSelect:ge,showIcon:!0,treeData:a,onDrop:function(s){if(s.dragNode.pos!=="".concat(s.node.pos,"-0")){if(s.node.parentId!==s.dragNode.parentId&&s.dragNode.parentId!==s.node.key){k.default.error(d.formatMessage({id:"pages.system.dept.tree.sortError",defaultMessage:"\u53EA\u80FD\u6539\u53D8\u540C\u7EA7\u673A\u6784\u7684\u987A\u5E8F"}));return}var Me=s.dragNode.parentId,Oe=(0,T.y)(a,Me,"key");if(Oe){var he,ce=(he=Oe[0].children)===null||he===void 0?void 0:he.map(function(ye){return ye.key}),Ee=s.dragNode.key,Se=ce.indexOf(Ee);ce.splice(Se,1,""),ce.splice(s.dropPosition,0,Ee),h.sortDept(ce.filter(function(ye){return ye}))}}},icon:function(s){var Me=s.expanded;return Me?(0,u.jsx)(de.Z,{}):!s.data.children||s.data.children.length===0?(0,u.jsx)(V.Z,{}):(0,u.jsx)(R.Z,{})}})})})},87113:function(De,se,e){"use strict";e.r(se),e.d(se,{default:function(){return Be}});var Ie=e(13062),re=e(71230),ne=e(57663),W=e(71577),A=e(66456),k=e(94132),B=e(39428),N=e(3182),ae=e(89032),K=e(15746),P=e(59250),le=e(13013),ue=e(30887),me=e(28682),fe=e(34792),S=e(48086),de=e(47673),V=e(77808),R=e(71194),i=e(50146),q=e(49111),Z=e(19650),G=e(71153),f=e(60331),T=e(94657),u=e(3980),b=e(34804),D=e(51042),l=e(84391),h=e(36450),E=e(16894),d=e(80582),a=e(67294),H=e(42285),F=e(40017),U=e(43358),O=e(34041),p=e(11849),z=e(62999),j=e(54680),I=e(86468),o=e(21307),L=e(50727),ge=e(60780),w=e.n(ge),s=e(85893),Me=(0,d.Pi)(function(Y){var Q,M=Y.user,xe=Y.onClose,oe=Y.onOk,J=(0,u.m2)(),t=(0,H.YB)(),Ze=(0,a.useRef)(),ie=M==null||(Q=M.roles)===null||Q===void 0?void 0:Q.map(function(c){return c.id}),X=!!(M!=null&&M.id),_=J.depts,$=J.positions,pe=(0,a.useState)(function(){var c;return(M==null||(c=M.userPositions)===null||c===void 0?void 0:c.map(function(C){return C.id}))||[]}),te=(0,T.Z)(pe,2),ee=te[0],r=te[1],je=(0,a.useMemo)(function(){return w()(_.map(function(c){return{value:c.id,title:c.name,key:c.id,parentId:c.parentId}}),{parentProperty:"parentId",customID:"value"})},[_]);(0,a.useEffect)(function(){$.length===0&&J.loadPositions({pageSize:1024})},[]);var Re=[{title:t.formatMessage({id:"pages.system.user.position.column.dept",defaultMessage:"\u673A\u6784\u540D\u79F0"}),dataIndex:"deptId",width:"30%",renderFormItem:function(C,y,v){var n=y.type,g=y.defaultRender,x=y.fieldProps;return n==="form"?(0,s.jsx)(j.Z,(0,p.Z)((0,p.Z)({allowClear:!0,treeData:je},x),{},{placeholder:t.formatMessage({id:"pages.system.user.position.dept.placeholder",defaultMessage:"\u8BF7\u9009\u62E9\u673A\u6784"})})):g(C)}},{title:t.formatMessage({id:"pages.system.user.position.column.name",defaultMessage:"\u5C97\u4F4D\u540D\u79F0"}),dataIndex:"positionId",width:"50%",renderFormItem:function(C,y,v){var n=y.type,g=y.defaultRender;return n==="form"?(0,s.jsx)(O.Z,{options:$.map(function(x){return{label:x.name,value:x.id}}),placeholder:t.formatMessage({id:"pages.system.user.position.placeholder",defaultMessage:"\u8BF7\u9009\u62E9\u5C97\u4F4D"})}):g(C)}},{title:t.formatMessage({id:"pages.system.common.column.actions",defaultMessage:"\u64CD\u4F5C"}),valueType:"option",width:200}];return(0,s.jsxs)(o.aN,{title:X?t.formatMessage({id:"pages.system.user.drawer.edit",defaultMessage:"\u4FEE\u6539\u7528\u6237"}):t.formatMessage({id:"pages.system.user.drawer.create",defaultMessage:"\u65B0\u5EFA\u7528\u6237"}),formRef:Ze,open:!0,initialValues:(0,p.Z)((0,p.Z)({},M),{},{roles:ie}),drawerProps:{forceRender:!0,destroyOnClose:!0,onClose:function(){xe()}},onFinish:function(){var c=(0,N.Z)((0,B.Z)().mark(function C(y){var v;return(0,B.Z)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,J.saveOrUpdateUser((0,p.Z)((0,p.Z)({},M),y));case 2:v=g.sent,v.success&&oe();case 4:case"end":return g.stop()}},C)}));return function(C){return c.apply(this,arguments)}}(),children:[(0,s.jsxs)(o.ZP.Group,{children:[(0,s.jsx)(o.V,{name:"name",width:"md",label:t.formatMessage({id:"pages.system.user.field.name.label",defaultMessage:"\u7528\u6237\u540D"}),tooltip:t.formatMessage({id:"pages.system.user.field.name.tooltip",defaultMessage:"\u6700\u957F\u4E3A 24 \u4F4D"}),id:"form-name",placeholder:t.formatMessage({id:"pages.system.user.field.name.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u540D\u79F0"}),required:!0,rules:[{required:!0,message:t.formatMessage({id:"pages.system.user.field.name.required",defaultMessage:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"})}]}),(0,s.jsx)(o.V,{width:"md",name:"username",label:t.formatMessage({id:"pages.system.user.field.username.label",defaultMessage:"\u767B\u5F55\u540D"}),placeholder:t.formatMessage({id:"pages.system.user.field.username.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u767B\u5F55\u8D26\u6237\u540D\u79F0"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.user.field.username.required",defaultMessage:"\u767B\u5F55\u540D\u4E0D\u80FD\u4E3A\u7A7A"})},{validator:function(){var c=(0,N.Z)((0,B.Z)().mark(function y(v,n){var g;return(0,B.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(n!==(M==null?void 0:M.username)){m.next=2;break}return m.abrupt("return");case 2:return m.next=4,u.hi.checkUsernameExist(n);case 4:if(g=m.sent,!g){m.next=7;break}throw new Error(t.formatMessage({id:"pages.system.user.field.username.duplicate",defaultMessage:"\u767B\u5F55\u540D\u5DF2\u5B58\u5728!"}));case 7:case"end":return m.stop()}},y)}));function C(y,v){return c.apply(this,arguments)}return C}()}],required:!0})]}),!X&&(0,s.jsxs)(o.ZP.Group,{children:[(0,s.jsx)(o.V.Password,{width:"md",name:"password",label:t.formatMessage({id:"pages.system.user.field.password.label",defaultMessage:"\u8F93\u5165\u5BC6\u7801"}),placeholder:t.formatMessage({id:"pages.system.user.field.password.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801"}),rules:[{required:!X,message:t.formatMessage({id:"pages.system.user.field.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801!"})}],required:!X}),(0,s.jsx)(o.V.Password,{width:"md",name:"rePassword",label:t.formatMessage({id:"pages.system.user.field.rePassword.label",defaultMessage:"\u786E\u8BA4\u5BC6\u7801"}),placeholder:t.formatMessage({id:"pages.system.user.field.rePassword.placeholder",defaultMessage:"\u518D\u6B21\u8F93\u5165\u5BC6\u7801"}),rules:[{required:!X,message:t.formatMessage({id:"pages.system.user.field.rePassword.required",defaultMessage:"\u786E\u8BA4\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A!"})},function(c){var C=c.getFieldValue;return{validator:function(v,n){return!n||C("password")===n?Promise.resolve():Promise.reject(new Error(t.formatMessage({id:"pages.system.user.field.rePassword.mismatch",defaultMessage:"\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!"})))}}}],required:!X})]}),(0,s.jsxs)(o.ZP.Group,{children:[(0,s.jsx)(o._I,{options:[{value:"M",label:t.formatMessage({id:"pages.system.user.field.gender.male",defaultMessage:"\u7537"})},{value:"F",label:t.formatMessage({id:"pages.system.user.field.gender.female",defaultMessage:"\u5973"})}],width:"md",name:"gender",label:t.formatMessage({id:"pages.system.user.field.gender.label",defaultMessage:"\u6027\u522B"})}),(0,s.jsx)(o._I,{required:!0,options:[{value:1,label:t.formatMessage({id:"pages.system.common.status.active",defaultMessage:"\u6FC0\u6D3B"})},{value:0,label:t.formatMessage({id:"pages.system.common.status.inactive",defaultMessage:"\u5931\u6D3B"})}],width:"md",name:"status",label:t.formatMessage({id:"pages.system.common.column.status",defaultMessage:"\u72B6\u6001"})})]}),(0,s.jsxs)(o.ZP.Group,{children:[(0,s.jsx)(o.V,{name:"phone",width:"md",label:t.formatMessage({id:"pages.system.common.column.phone",defaultMessage:"\u624B\u673A"}),placeholder:t.formatMessage({id:"pages.system.user.field.phone.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"})}),(0,s.jsx)(o.V,{width:"md",name:"email",label:t.formatMessage({id:"pages.system.user.field.email.label",defaultMessage:"\u90AE\u7BB1"}),placeholder:t.formatMessage({id:"pages.system.user.field.email.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u90AE\u7BB1"}),rules:[{type:"email",message:t.formatMessage({id:"pages.system.user.field.email.invalid",defaultMessage:"\u8BF7\u8F93\u5165\u90AE\u7BB1!"})}]}),(0,s.jsx)(I.FQ,{name:"deptId",width:"md",treeData:je,label:t.formatMessage({id:"pages.system.common.column.dept",defaultMessage:"\u7EC4\u7EC7\u673A\u6784"}),placeholder:t.formatMessage({id:"pages.system.user.field.dept.placeholder",defaultMessage:"\u8BF7\u9009\u62E9\u7EC4\u7EC7\u673A\u6784"}),value:M==null?void 0:M.deptId}),(0,s.jsx)(o._I,{mode:"tags",request:(0,N.Z)((0,B.Z)().mark(function c(){return(0,B.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",u.hi.loadRoles({current:1,pageSize:1024}).then(function(v){return v.list.map(function(n){return{label:n.name,value:n.id}})}));case 1:case"end":return y.stop()}},c)})),width:"md",name:"roles",label:t.formatMessage({id:"pages.system.user.field.roles.label",defaultMessage:"\u89D2\u8272\u5217\u8868"})})]}),(0,s.jsx)(o.ZP.Group,{children:(0,s.jsx)(o.ZP.Item,{label:t.formatMessage({id:"pages.system.user.field.positions.label",defaultMessage:"\u9009\u62E9\u5C97\u4F4D"}),name:"userPositions",trigger:"onValuesChange",children:(0,s.jsx)(L.Z,{rowKey:"id",toolBarRender:!1,columns:Re,recordCreatorProps:{newRecordType:"dataSource",position:"top",record:function(){return{id:"".concat(Date.now())}}},editable:{type:"multiple",editableKeys:ee,onChange:r,actionRender:function(C,y,v){return[v.delete]}}})})})]})}),Oe=e(43185),he=e(28525),ce=e(69753),Ee=e(43347),Se=he.Z.Dragger;function ye(Y){var Q=Y.onCancel,M=Y.onOk,xe=(0,a.useState)(!1),oe=(0,T.Z)(xe,2),J=oe[0],t=oe[1],Ze=(0,a.useState)([]),ie=(0,T.Z)(Ze,2),X=ie[0],_=ie[1],$=(0,H.YB)(),pe={multiple:!1,accept:".xlsx",beforeUpload:function(ee){return _([ee]),!1},onRemove:function(){_([])},maxCount:1};return(0,s.jsx)(i.Z,{title:$.formatMessage({id:"pages.system.user.import.title",defaultMessage:"\u6279\u91CF\u5BFC\u5165\u7528\u6237"}),onCancel:Q,open:!0,maskClosable:!1,footer:[(0,s.jsx)(W.Z,{onClick:Q,children:$.formatMessage({id:"pages.common.cancel",defaultMessage:"\u53D6\u6D88"})},"cancel"),(0,s.jsx)(W.Z,{icon:(0,s.jsx)(ce.Z,{}),onClick:function(){u.hi.download("/api/file/downloadTemplate?name=\u5377\u738B\u7528\u6237\u5BFC\u5165\u6A21\u677F")},children:$.formatMessage({id:"pages.system.user.import.download",defaultMessage:"\u4E0B\u8F7D\u6A21\u677F"})},"downloadTemplate"),(0,s.jsx)(W.Z,{icon:(0,s.jsx)(l.Z,{}),type:"primary",loading:J,onClick:function(){if(X.length===0){S.default.error($.formatMessage({id:"pages.system.user.import.noFile",defaultMessage:"\u8BF7\u9009\u62E9\u6587\u4EF6"}));return}t(!0),u.hi.upload("/api/importUser",{file:X[0]},function(ee){}).then(function(ee){t(!1),ee.success?(S.default.success($.formatMessage({id:"pages.system.user.import.success",defaultMessage:"\u5BFC\u5165\u6210\u529F"})),M()):S.default.error(ee.message)})},children:$.formatMessage({id:"pages.common.import",defaultMessage:"\u5BFC\u5165"})},"importTemplate")],children:(0,s.jsxs)(Se,(0,p.Z)((0,p.Z)({},pe),{},{children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(Ee.Z,{})}),(0,s.jsx)("p",{className:"ant-upload-text",children:$.formatMessage({id:"pages.common.upload.drag",defaultMessage:"\u70B9\u51FB\u6216\u8005\u62D6\u62FDExcel\u6587\u4EF6\u5230\u6B64\u5904"})})]}))})}var Ue=["magenta","volcano","cyan","blue","geekblue","purple"],Ae=(0,d.Pi)(function(){var Y=(0,u.m2)(),Q=(0,a.useRef)(),M=(0,a.useRef)(),xe=(0,a.useState)(),oe=(0,T.Z)(xe,2),J=oe[0],t=oe[1],Ze=(0,a.useState)(!1),ie=(0,T.Z)(Ze,2),X=ie[0],_=ie[1],$=(0,a.useState)(),pe=(0,T.Z)($,2),te=pe[0],ee=pe[1],r=(0,H.YB)();(0,a.useEffect)(function(){Y.loadPermissions()},[Y]);var je=[{title:r.formatMessage({id:"pages.system.common.column.dept",defaultMessage:"\u7EC4\u7EC7\u673A\u6784"}),dataIndex:"deptName",hideInSearch:!0,width:150},{title:r.formatMessage({id:"pages.system.common.column.name",defaultMessage:"\u59D3\u540D"}),dataIndex:"name",ellipsis:!0,width:120},{title:r.formatMessage({id:"pages.system.user.column.roles",defaultMessage:"\u89D2\u8272"}),dataIndex:"role",hideInSearch:!0,width:150,renderFormItem:function(n,g){var x=g.defaultRender;return x(n)},render:function(n,g){var x;return(0,s.jsx)(Z.Z,{children:(x=g.roles)===null||x===void 0?void 0:x.filter(function(m){return m}).map(function(m,Ce){return(0,s.jsx)(f.Z,{color:Ue[Ce],children:m.name},m.id)})})}},{title:r.formatMessage({id:"pages.system.common.column.phone",defaultMessage:"\u624B\u673A"}),dataIndex:"phone",width:150,search:!1},{title:r.formatMessage({id:"pages.system.common.column.status",defaultMessage:"\u72B6\u6001"}),dataIndex:"status",search:!1,width:100,valueEnum:{0:{text:r.formatMessage({id:"pages.system.common.status.inactive",defaultMessage:"\u5931\u6D3B"}),status:"Default"},1:{text:r.formatMessage({id:"pages.system.common.status.active",defaultMessage:"\u6FC0\u6D3B"}),status:"Processing"}}},{title:r.formatMessage({id:"pages.system.common.column.createdAt",defaultMessage:"\u521B\u5EFA\u65F6\u95F4"}),key:"showTime",dataIndex:"createAt",width:150,valueType:"dateTime",hideInSearch:!0},{title:r.formatMessage({id:"pages.system.common.column.actions",defaultMessage:"\u64CD\u4F5C"}),valueType:"option",width:140,dataIndex:"setting",fixed:"right",render:function(n,g){return[(0,s.jsx)("a",{onClick:function(){t({visible:!0,current:g})},children:r.formatMessage({id:"pages.common.edit",defaultMessage:"\u7F16\u8F91"})},"editable"),(0,s.jsx)(le.Z,{overlay:(0,s.jsx)(me.Z,{onClick:function(m){var Ce=m.key;if(Ce==="resetPwd")i.Z.confirm({title:r.formatMessage({id:"pages.system.user.modal.resetPassword.title",defaultMessage:"\u91CD\u7F6E\u5BC6\u7801"}),content:(0,s.jsx)(V.Z.Password,{placeholder:r.formatMessage({id:"pages.system.user.modal.resetPassword.placeholder",defaultMessage:"\u8F93\u5165\u5BC6\u7801"}),onChange:function(ve){return M.current=ve.target.value}}),okType:"primary",okText:r.formatMessage({id:"pages.system.user.modal.resetPassword.ok",defaultMessage:"\u4FEE\u6539"}),cancelText:r.formatMessage({id:"pages.common.cancel",defaultMessage:"\u53D6\u6D88"}),onOk:function(ve){return M.current?(u.hi.updateUser({id:g.id,password:M.current}).then(function(Pe){Pe.success&&(S.default.success(r.formatMessage({id:"pages.system.user.message.resetSuccess",defaultMessage:"\u4FEE\u6539\u6210\u529F"})),M.current=void 0,ve())}),!1):(S.default.error(r.formatMessage({id:"pages.system.user.message.passwordRequired",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801"})),!1)}});else if(Ce==="delete"){if(g.id==="1"){i.Z.info({title:r.formatMessage({id:"pages.system.user.modal.info.title",defaultMessage:"\u63D0\u793A"}),content:r.formatMessage({id:"pages.system.user.modal.info.content",defaultMessage:"\u5185\u7F6E\u7528\u6237\u4E0D\u80FD\u5220\u9664"}),okText:r.formatMessage({id:"pages.common.ok",defaultMessage:"\u786E\u5B9A"})});return}i.Z.confirm({title:r.formatMessage({id:"pages.system.user.modal.delete.title",defaultMessage:"\u5220\u9664\u7528\u6237"}),content:r.formatMessage({id:"pages.system.user.modal.delete.content",defaultMessage:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u7528\u6237\u5417\uFF1F"}),okType:"danger",okText:r.formatMessage({id:"pages.common.delete",defaultMessage:"\u5220\u9664"}),cancelText:r.formatMessage({id:"pages.common.cancel",defaultMessage:"\u53D6\u6D88"}),onOk:function(){Y.deleteUser(g.id).then(function(ve){if(ve.success){var Pe;S.default.success(r.formatMessage({id:"pages.system.user.message.deleteSuccess",defaultMessage:"\u5220\u9664\u6210\u529F"})),(Pe=Q.current)===null||Pe===void 0||Pe.reload()}else S.default.error(ve.message||r.formatMessage({id:"pages.system.user.message.deleteFail",defaultMessage:"\u5220\u9664\u5931\u8D25"}))})}})}},items:[{label:r.formatMessage({id:"pages.system.user.action.resetPassword",defaultMessage:"\u91CD\u7F6E\u5BC6\u7801"}),key:"resetPwd"},{label:r.formatMessage({id:"pages.system.user.action.delete",defaultMessage:"\u5220\u9664\u7528\u6237"}),key:"delete"}]}),children:(0,s.jsxs)("a",{className:"ant-dropdown-link",onClick:function(m){return m.preventDefault()},children:[r.formatMessage({id:"pages.common.more",defaultMessage:"\u66F4\u591A"}),(0,s.jsx)(b.Z,{})]})},"action")]}}],Re=(0,a.useState)([]),c=(0,T.Z)(Re,2),C=c[0],y=c[1];return(0,s.jsxs)(h._z,{title:!1,children:[(0,s.jsxs)(re.Z,{gutter:20,children:[(0,s.jsx)(K.Z,{xs:0,md:6,children:(0,s.jsx)(F.A,{onSelect:function(n){return ee(n)}})}),(0,s.jsxs)(K.Z,{xs:24,md:18,children:[(0,s.jsx)(E.ZP,{columns:je,bordered:!0,actionRef:Q,params:{deptId:te},request:function(){var v=(0,N.Z)((0,B.Z)().mark(function n(g){return(0,B.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",Y.loadUsers(g));case 1:case"end":return m.stop()}},n)}));return function(n){return v.apply(this,arguments)}}(),rowSelection:{selections:[k.Z.SELECTION_ALL,k.Z.SELECTION_INVERT],selectedRowKeys:C,onChange:function(n,g,x){y(n)}},tableAlertRender:function(n){var g=n.selectedRowKeys,x=n.selectedRows,m=n.onCleanSelected;return(0,s.jsx)(Z.Z,{size:24,children:(0,s.jsxs)("span",{children:[r.formatMessage({id:"pages.system.user.table.selected",defaultMessage:"\u5DF2\u9009 {count} \u9879"},{count:g.length}),(0,s.jsx)("a",{style:{marginInlineStart:8},onClick:m,children:r.formatMessage({id:"pages.system.user.table.clearSelection",defaultMessage:"\u53D6\u6D88\u9009\u62E9"})})]})})},tableAlertOptionRender:function(){return(0,s.jsx)(Z.Z,{size:16,children:(0,s.jsx)("a",{onClick:function(){i.Z.confirm({title:r.formatMessage({id:"pages.system.user.modal.batchDelete.title",defaultMessage:"\u6279\u91CF\u5220\u9664"}),content:r.formatMessage({id:"pages.system.user.modal.batchDelete.content",defaultMessage:"\u786E\u5B9A\u5220\u9664\u9009\u62E9\u7684\u7528\u6237\u5417\uFF1F"}),okText:r.formatMessage({id:"pages.common.delete",defaultMessage:"\u5220\u9664"}),cancelText:r.formatMessage({id:"pages.common.cancel",defaultMessage:"\u53D6\u6D88"}),onOk:function(){Y.deleteUser(C.join(",")).then(function(x){if(x.success){var m;S.default.success(r.formatMessage({id:"pages.system.user.message.deleteSuccess",defaultMessage:"\u5220\u9664\u6210\u529F"})),(m=Q.current)===null||m===void 0||m.reload()}})}})},children:r.formatMessage({id:"pages.system.user.action.batchDelete",defaultMessage:"\u6279\u91CF\u5220\u9664"})})})},rowKey:"id",search:{labelWidth:"auto"},pagination:{defaultPageSize:10,showSizeChanger:!0},scroll:{x:900},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.system.user.header",defaultMessage:"\u7CFB\u7EDF\u7528\u6237\u5217\u8868"}),toolBarRender:function(){return[(0,s.jsx)(W.Z,{icon:(0,s.jsx)(D.Z,{}),type:"primary",onClick:function(){t({visible:!0})},children:r.formatMessage({id:"pages.common.new",defaultMessage:"\u65B0\u5EFA"})},"button"),(0,s.jsx)(W.Z,{icon:(0,s.jsx)(l.Z,{}),type:"primary",onClick:function(){_(!0)},children:r.formatMessage({id:"pages.system.user.toolbar.import",defaultMessage:"\u6279\u91CF\u5BFC\u5165"})},"import")]}}),(J==null?void 0:J.visible)&&(0,s.jsx)(Me,{onClose:function(){t(void 0)},onOk:function(){var n;t(void 0),(n=Q.current)===null||n===void 0||n.reload()},user:J.current})]})]}),X&&(0,s.jsx)(ye,{onCancel:function(){return _(!1)},onOk:function(){var n;_(!1),(n=Q.current)===null||n===void 0||n.reload()}})]})}),Be=Ae}}]);
