(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[7915],{87113:function(xe,L,t){"use strict";t.r(L),t.d(L,{default:function(){return pe}});var Ce=t(13062),H=t(71230),ye=t(57663),E=t(71577),Ze=t(66456),b=t(53831),F=t(39428),U=t(3182),Fe=t(89032),G=t(15746),je=t(59250),J=t(13013),ge=t(30887),X=t(28682),Se=t(34792),g=t(48086),Be=t(47673),Y=t(4107),Ie=t(71194),D=t(50146),Re=t(49111),K=t(19650),Ee=t(71153),q=t(60331),S=t(94657),B=t(3980),_=t(57254),ee=t(49101),$=t(84391),te=t(36450),M=t(91186),Q=t(80582),f=t(67294),ne=t(40017),De=t(43358),re=t(34041),j=t(11849),Pe=t(62999),ue=t(54680),ae=t(86468),c=t(82837),le=t(60780),se=t.n(le),e=t(85893),oe=(0,Q.Pi)(function(v){var m,s=v.user,P=v.onClose,I=v.onOk,p=(0,B.m2)(),x=(0,f.useRef)(),w=s==null||(m=s.roles)===null||m===void 0?void 0:m.map(function(a){return a.id}),h=!!(s!=null&&s.id),R=p.depts,C=p.positions,O=(0,f.useState)(function(){var a;return(s==null||(a=s.userPositions)===null||a===void 0?void 0:a.map(function(d){return d.id}))||[]}),y=(0,S.Z)(O,2),Z=y[0],N=y[1],V=(0,f.useMemo)(function(){return se()(R.map(function(a){return{value:a.id,title:a.name,key:a.id,parentId:a.parentId}}),{parentProperty:"parentId",customID:"value"})},[R]);(0,f.useEffect)(function(){C.length===0&&p.loadPositions({pageSize:1024})},[]);var z=[{title:"\u673A\u6784\u540D\u79F0",dataIndex:"deptId",width:"30%",renderFormItem:function(d,o,l){var n=o.type,u=o.defaultRender,i=o.fieldProps;return n==="form"?(0,e.jsx)(ue.Z,(0,j.Z)((0,j.Z)({allowClear:!0,treeData:V},i),{},{placeholder:"\u8BF7\u9009\u62E9\u673A\u6784"})):u(d)}},{title:"\u5C97\u4F4D\u540D\u79F0",dataIndex:"positionId",width:"50%",renderFormItem:function(d,o,l){var n=o.type,u=o.defaultRender;return n==="form"?(0,e.jsx)(re.Z,{options:C.map(function(i){return{label:i.name,value:i.id}}),placeholder:"\u8BF7\u9009\u62E9\u5C97\u4F4D"}):u(d)}},{title:"\u64CD\u4F5C",valueType:"option",width:200}];return(0,e.jsxs)(c.aN,{title:h?"\u4FEE\u6539\u7528\u6237":"\u65B0\u5EFA\u7528\u6237",formRef:x,open:!0,initialValues:(0,j.Z)((0,j.Z)({},s),{},{roles:w}),drawerProps:{forceRender:!0,destroyOnClose:!0,onClose:function(){P()}},onFinish:function(){var a=(0,U.Z)((0,F.Z)().mark(function d(o){var l;return(0,F.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,p.saveOrUpdateUser((0,j.Z)((0,j.Z)({},s),o));case 2:l=u.sent,l.success&&I();case 4:case"end":return u.stop()}},d)}));return function(d){return a.apply(this,arguments)}}(),children:[(0,e.jsxs)(c.ZP.Group,{children:[(0,e.jsx)(c.V,{name:"name",width:"md",label:"\u7528\u6237\u540D",tooltip:"\u6700\u957F\u4E3A 24 \u4F4D",id:"form-name",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",required:!0,rules:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(c.V,{width:"md",name:"username",label:"\u767B\u5F55\u540D",placeholder:"\u8BF7\u8F93\u5165\u767B\u5F55\u8D26\u6237\u540D\u79F0",rules:[{required:!0,message:"\u767B\u5F55\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{validator:function(){var a=(0,U.Z)((0,F.Z)().mark(function o(l,n){var u;return(0,F.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n!==(s==null?void 0:s.username)){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,B.hi.checkUsernameExist(n);case 4:if(u=r.sent,!u){r.next=7;break}throw new Error("\u767B\u5F55\u540D\u5DF2\u5B58\u5728!");case 7:case"end":return r.stop()}},o)}));function d(o,l){return a.apply(this,arguments)}return d}()}],required:!0})]}),!h&&(0,e.jsxs)(c.ZP.Group,{children:[(0,e.jsx)(c.V.Password,{width:"md",name:"password",label:"\u8F93\u5165\u5BC6\u7801",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",rules:[{required:!h,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],required:!h}),(0,e.jsx)(c.V.Password,{width:"md",name:"rePassword",label:"\u786E\u8BA4\u5BC6\u7801",placeholder:"\u518D\u6B21\u8F93\u5165\u5BC6\u7801",rules:[{required:!h,message:"\u786E\u8BA4\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A!"},function(a){var d=a.getFieldValue;return{validator:function(l,n){return!n||d("password")===n?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!"))}}}],required:!h})]}),(0,e.jsxs)(c.ZP.Group,{children:[(0,e.jsx)(c._I,{options:[{value:"M",label:"\u7537"},{value:"F",label:"\u5973"}],width:"md",name:"gender",label:"\u6027\u522B"}),(0,e.jsx)(c._I,{required:!0,options:[{value:1,label:"\u6FC0\u6D3B"},{value:0,label:"\u5931\u6D3B"}],width:"md",name:"status",label:"\u72B6\u6001"})]}),(0,e.jsxs)(c.ZP.Group,{children:[(0,e.jsx)(c.V,{name:"phone",width:"md",label:"\u624B\u673A",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"}),(0,e.jsx)(c.V,{width:"md",name:"email",label:"\u90AE\u7BB1",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",rules:[{type:"email",message:"\u8BF7\u8F93\u5165\u90AE\u7BB1!"}]}),(0,e.jsx)(ae.FQ,{name:"deptId",width:"md",treeData:V,label:"\u7EC4\u7EC7\u673A\u6784",placeholder:"\u8BF7\u9009\u62E9\u7EC4\u7EC7\u673A\u6784",value:s==null?void 0:s.deptId}),(0,e.jsx)(c._I,{mode:"tags",request:(0,U.Z)((0,F.Z)().mark(function a(){return(0,F.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",B.hi.loadRoles({current:1,pageSize:1024}).then(function(l){return l.list.map(function(n){return{label:n.name,value:n.id}})}));case 1:case"end":return o.stop()}},a)})),width:"md",name:"roles",label:"\u89D2\u8272\u5217\u8868"})]}),(0,e.jsx)(c.ZP.Group,{children:(0,e.jsx)(c.ZP.Item,{label:"\u9009\u62E9\u5C97\u4F4D",name:"userPositions",trigger:"onValuesChange",children:(0,e.jsx)(M.nx,{rowKey:"id",toolBarRender:!1,columns:z,recordCreatorProps:{newRecordType:"dataSource",position:"top",record:function(){return{id:"".concat(Date.now())}}},editable:{type:"multiple",editableKeys:Z,onChange:N,actionRender:function(d,o,l){return[l.delete]}}})})})]})}),we=t(43185),ie=t(32620),de=t(90631),ce=t(43347),fe=ie.Z.Dragger;function ve(v){var m=v.onCancel,s=v.onOk,P=(0,f.useState)(!1),I=(0,S.Z)(P,2),p=I[0],x=I[1],w=(0,f.useState)([]),h=(0,S.Z)(w,2),R=h[0],C=h[1],O={multiple:!1,accept:".xlsx",beforeUpload:function(Z){return C([Z]),!1},onRemove:function(){C([])},maxCount:1};return(0,e.jsx)(D.Z,{title:"\u6279\u91CF\u5BFC\u5165\u7528\u6237",onCancel:m,open:!0,maskClosable:!1,footer:[(0,e.jsx)(E.Z,{onClick:m,children:"\u53D6\u6D88"},"cancel"),(0,e.jsx)(E.Z,{icon:(0,e.jsx)(de.Z,{}),onClick:function(){B.hi.download("/api/file/downloadTemplate?name=\u5377\u738B\u7528\u6237\u5BFC\u5165\u6A21\u677F")},children:"\u4E0B\u8F7D\u6A21\u677F"},"downloadTemplate"),(0,e.jsx)(E.Z,{icon:(0,e.jsx)($.Z,{}),type:"primary",loading:p,onClick:function(){if(R.length===0){g.default.error("\u8BF7\u9009\u62E9\u6587\u4EF6");return}x(!0),B.hi.upload("/api/importUser",{file:R[0]},function(Z){}).then(function(Z){x(!1),Z.success?(g.default.success("\u5BFC\u5165\u6210\u529F"),s()):g.default.error(Z.message)})},children:"\u5BFC\u5165"},"importTemplate")],children:(0,e.jsxs)(fe,(0,j.Z)((0,j.Z)({},O),{},{children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(ce.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u8005\u62D6\u62FDExcel\u6587\u4EF6\u5230\u6B64\u5904"})]}))})}var me=["magenta","volcano","cyan","blue","geekblue","purple"],he=(0,Q.Pi)(function(){var v=(0,B.m2)(),m=(0,f.useRef)(),s=(0,f.useRef)(),P=(0,f.useState)(),I=(0,S.Z)(P,2),p=I[0],x=I[1],w=(0,f.useState)(!1),h=(0,S.Z)(w,2),R=h[0],C=h[1],O=(0,f.useState)(),y=(0,S.Z)(O,2),Z=y[0],N=y[1];(0,f.useEffect)(function(){v.loadPermissions()},[v]);var V=[{title:"\u7EC4\u7EC7\u673A\u6784",dataIndex:"deptName",hideInSearch:!0,width:150},{title:"\u59D3\u540D",dataIndex:"name",ellipsis:!0,width:120},{title:"\u89D2\u8272",dataIndex:"role",hideInSearch:!0,width:150,renderFormItem:function(n,u){var i=u.defaultRender;return i(n)},render:function(n,u){var i;return(0,e.jsx)(K.Z,{children:(i=u.roles)===null||i===void 0?void 0:i.filter(function(r){return r}).map(function(r,k){return(0,e.jsx)(q.Z,{color:me[k],children:r.name},r.id)})})}},{title:"\u624B\u673A",dataIndex:"phone",width:150,search:!1},{title:"\u72B6\u6001",dataIndex:"status",search:!1,width:100,valueEnum:{0:{text:"\u5931\u6D3B",status:"Default"},1:{text:"\u6FC0\u6D3B",status:"Processing"}}},{title:"\u521B\u5EFA\u65F6\u95F4",key:"showTime",dataIndex:"createAt",width:150,valueType:"dateTime",hideInSearch:!0},{title:"\u64CD\u4F5C",valueType:"option",width:140,dataIndex:"setting",fixed:"right",render:function(n,u){return[(0,e.jsx)("a",{onClick:function(){x({visible:!0,current:u})},children:"\u7F16\u8F91"},"editable"),(0,e.jsx)(J.Z,{overlay:(0,e.jsx)(X.Z,{onClick:function(r){var k=r.key;if(k==="resetPwd")D.Z.confirm({title:"\u91CD\u7F6E\u5BC6\u7801",content:(0,e.jsx)(Y.Z.Password,{placeholder:"\u8F93\u5165\u5BC6\u7801",onChange:function(T){return s.current=T.target.value}}),okType:"primary",okText:"\u4FEE\u6539",cancelText:"\u53D6\u6D88",onOk:function(T){return s.current?(B.hi.updateUser({id:u.id,password:s.current}).then(function(A){A.success&&(g.default.success("\u4FEE\u6539\u6210\u529F"),s.current=void 0,T())}),!1):(g.default.error("\u8BF7\u8F93\u5165\u5BC6\u7801"),!1)}});else if(k==="delete"){if(u.id==="1"){D.Z.info({title:"\u63D0\u793A",content:"\u5185\u7F6E\u7528\u6237\u4E0D\u80FD\u5220\u9664"});return}D.Z.confirm({title:"\u5220\u9664\u7528\u6237",content:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u7528\u6237\u5417\uFF1F",okType:"danger",okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",onOk:function(){v.deleteUser(u.id).then(function(T){if(T.success){var A;g.default.success("\u5220\u9664\u6210\u529F"),(A=m.current)===null||A===void 0||A.reload()}})}})}},items:[{label:"\u91CD\u7F6E\u5BC6\u7801",key:"resetPwd"},{label:"\u5220\u9664\u7528\u6237",key:"delete"}]}),children:(0,e.jsxs)("a",{className:"ant-dropdown-link",onClick:function(r){return r.preventDefault()},children:["\u66F4\u591A",(0,e.jsx)(_.Z,{})]})},"action")]}}],z=(0,f.useState)([]),a=(0,S.Z)(z,2),d=a[0],o=a[1];return(0,e.jsxs)(te._z,{title:!1,children:[(0,e.jsxs)(H.Z,{gutter:20,children:[(0,e.jsx)(G.Z,{xs:0,md:6,children:(0,e.jsx)(ne.A,{onSelect:function(n){return N(n)}})}),(0,e.jsxs)(G.Z,{xs:24,md:18,children:[(0,e.jsx)(M.ZP,{columns:V,bordered:!0,actionRef:m,params:{deptId:Z},request:function(){var l=(0,U.Z)((0,F.Z)().mark(function n(u){return(0,F.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",v.loadUsers(u));case 1:case"end":return r.stop()}},n)}));return function(n){return l.apply(this,arguments)}}(),rowSelection:{selections:[b.Z.SELECTION_ALL,b.Z.SELECTION_INVERT],selectedRowKeys:d,onChange:function(n,u,i){o(n)}},tableAlertRender:function(n){var u=n.selectedRowKeys,i=n.selectedRows,r=n.onCleanSelected;return(0,e.jsx)(K.Z,{size:24,children:(0,e.jsxs)("span",{children:["\u5DF2\u9009 ",u.length," \u9879",(0,e.jsx)("a",{style:{marginInlineStart:8},onClick:r,children:"\u53D6\u6D88\u9009\u62E9"})]})})},tableAlertOptionRender:function(){return(0,e.jsx)(K.Z,{size:16,children:(0,e.jsx)("a",{onClick:function(){D.Z.confirm({title:"\u6279\u91CF\u5220\u9664",content:"\u786E\u5B9A\u5220\u9664\u9009\u62E9\u7684\u7528\u6237\u5417\uFF1F",onOk:function(){v.deleteUser(d.join(",")).then(function(i){if(i.success){var r;g.default.success("\u5220\u9664\u6210\u529F"),(r=m.current)===null||r===void 0||r.reload()}})}})},children:"\u6279\u91CF\u5220\u9664"})})},rowKey:"id",search:{labelWidth:"auto"},pagination:{defaultPageSize:10,showSizeChanger:!0},scroll:{x:900},dateFormatter:"string",headerTitle:"\u7CFB\u7EDF\u7528\u6237\u5217\u8868",toolBarRender:function(){return[(0,e.jsx)(E.Z,{icon:(0,e.jsx)(ee.Z,{}),type:"primary",onClick:function(){x({visible:!0})},children:"\u65B0\u5EFA"},"button"),(0,e.jsx)(E.Z,{icon:(0,e.jsx)($.Z,{}),type:"primary",onClick:function(){C(!0)},children:"\u6279\u91CF\u5BFC\u5165"},"import")]}}),(p==null?void 0:p.visible)&&(0,e.jsx)(oe,{onClose:function(){x(void 0)},onOk:function(){var n;x(void 0),(n=m.current)===null||n===void 0||n.reload()},user:p.current})]})]}),R&&(0,e.jsx)(ve,{onCancel:function(){return C(!1)},onOk:function(){var n;C(!1),(n=m.current)===null||n===void 0||n.reload()}})]})}),pe=he}}]);
