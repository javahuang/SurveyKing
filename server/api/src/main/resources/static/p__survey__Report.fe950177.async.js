(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[5349],{66640:function(U,w,r){"use strict";r.r(w),r.d(w,{Report:function(){return z},default:function(){return Me}});var u=r(67294),j=r(80582),L=r(23156),T=r(11628),I=(0,u.createContext)({}),N=I.Provider,Re=I.Consumer;function W(n){var s=["Radio","Checkbox","Cascader","Select","QuestionSet","Nps","Score"];if(s.includes(n.type))return!0;if(n.type==="FillBlank"||n.type==="MultipleBlank"){var a;if((a=n.children)!==null&&a!==void 0&&a.find(function(t){var l;return((l=t.attribute)===null||l===void 0?void 0:l.dataType)==="number"}))return!0}return!1}var H={Radio:{id:"pages.survey.report.question.type.radio",defaultMessage:"\u5355\u9009\u9898"},Checkbox:{id:"pages.survey.report.question.type.checkbox",defaultMessage:"\u591A\u9009\u9898"},Cascader:{id:"pages.survey.report.question.type.cascader",defaultMessage:"\u7EA7\u8054\u9898"},Select:{id:"pages.survey.report.question.type.select",defaultMessage:"\u4E0B\u62C9\u9898"},FillBlank:{id:"pages.survey.report.question.type.fillBlank",defaultMessage:"\u5355\u884C\u6587\u672C\u9898"},Textarea:{id:"pages.survey.report.question.type.textarea",defaultMessage:"\u591A\u884C\u6587\u672C\u9898"},MultipleBlank:{id:"pages.survey.report.question.type.multipleBlank",defaultMessage:"\u591A\u9879\u586B\u7A7A\u9898"},Nps:{id:"pages.survey.report.question.type.nps",defaultMessage:"Nps\u9898"},Score:{id:"pages.survey.report.question.type.score",defaultMessage:"\u6253\u5206\u9898"},Judge:{id:"pages.survey.report.question.type.judge",defaultMessage:"\u5224\u65AD\u9898"}},G=function(s,a){if(!a)return"";var t=H[a];return t?s.formatMessage({id:t.id,defaultMessage:t.defaultMessage}):""},V=r(69610),Y=r(54941),J=function(){function n(){(0,V.Z)(this,n),this._init=this._init.bind(this),this._cleanUp=this._cleanUp.bind(this),this.convertFromInput=this.convertFromInput.bind(this)}return(0,Y.Z)(n,[{key:"_init",value:function(){this.canvas=document.createElement("canvas"),this.imgPreview=document.createElement("img"),this.imgPreview.style="position: absolute; top: -9999px",document.body.appendChild(this.imgPreview),this.canvasCtx=this.canvas.getContext("2d")}},{key:"_cleanUp",value:function(){document.body.removeChild(this.imgPreview)}},{key:"convertFromInput",value:function(a,t){this._init();var l=this;this.imgPreview.onload=function(){var h=new Image;l.canvas.width=l.imgPreview.clientWidth,l.canvas.height=l.imgPreview.clientHeight,h.crossOrigin="anonymous",h.src=l.imgPreview.src,h.onload=function(){l.canvasCtx.drawImage(h,0,0);var i=l.canvas.toDataURL("image/png");typeof t=="function"&&t(i),l._cleanUp()}},this.imgPreview.src=a}}]),n}(),e=r(85893),Q=function(s){var a;return s?(a=s.children)===null||a===void 0?void 0:a.filter(function(t){return W(t)}).map(function(t){return t.type==="QuestionSet"?(0,e.jsx)(X,{schema:t},t.id):(0,e.jsx)(ve,{schema:t},t.id)}):(0,e.jsx)(e.Fragment,{})},K=(0,j.Pi)(function(){var n=(0,T.IE)(),s=n.schema;return(0,e.jsx)("div",{children:Q(s)})}),X=function(s){return(0,e.jsx)("div",{children:Q(s.schema)})},Ze=r(13062),A=r(71230),Pe=r(66456),$=r(94132),Te=r(89032),R=r(15746),Ne=r(57663),Z=r(71577),q=r(94657),_=r(3375),ee=r(83279),te=r(68023),re=r(81615),ae=r(71257),ne=r(82242),se=r(8690),ie=r(17813),oe=r(73761),le=r(93450),ue=r(50434);te.D([se.N,ie.N,oe.N,ae.N,ne.N,ue.N,le.N]);var P=[{color:"#5398ff"},{color:"#39d2d9"},{color:"#f16b79"},{color:"#b18160"},{color:"#94ed8c"},{color:"#ffb878"},{color:"#99a4ff"},{color:"#808bea"},{color:"#c36cff"}],de=(0,u.forwardRef)(function(n,s){var a=n.data,t=n.labels,l=n.loading,h=n.name,i=n.type,o=(0,u.useRef)(null),f=(0,u.useRef)();return(0,u.useEffect)(function(){if(o.current){var M=re.S1(o.current);return f.current=M,function(){M.dispose()}}},[]),(0,u.useImperativeHandle)(s,function(){return{saveAsImage:function(){var d;return(d=f.current)===null||d===void 0?void 0:d.getDataURL({type:"png"})}}}),(0,u.useEffect)(function(){if(!l&&f.current){f.current.hideLoading(),f.current.clear();var M=300;i==="horizontalBar"?(f.current.setOption({title:{text:h},grid:{top:15,bottom:15,left:10*Math.max.apply(Math,(0,ee.Z)(t.map(function(d){return d.length})))+25,right:50},tooltip:{show:!0,trigger:"item"},xAxis:{show:!1},yAxis:{type:"category",data:t,inverse:!0},series:[{type:"bar",barWidth:12,data:a==null?void 0:a.map(function(d,c){var p=d.value,S=d.percent;return{value:p,percent:S,itemStyle:P[c%P.length]}}),showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"},label:{show:!0,position:"right",color:"black",formatter:function(c){var p=c.data;return p.percent||"0%"}}}]}),M=t.length*40-t.length):i==="pie"?f.current.setOption({title:{text:h},tooltip:{show:!0,trigger:"item"},series:[{name:h,type:"pie",radius:"60%",data:a==null?void 0:a.map(function(d,c){var p=d.value,S=d.percent;return{value:p,name:"".concat(t[c]," ").concat(S),itemStyle:P[c%P.length]}}),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},labelLine:{length:10,length2:25}}]}):i==="bar"&&f.current.setOption({title:{text:h},tooltip:{show:!0,trigger:"item"},xAxis:{type:"category",data:t,axisLabel:{interval:0,rotate:30}},yAxis:{show:!1},series:[{type:"bar",barWidth:15,data:a==null?void 0:a.map(function(d,c){var p=d.value,S=d.percent;return{value:p,percent:S,itemStyle:P[c%P.length]}}),showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"},label:{show:!0,position:"top",color:"black",formatter:function(c){var p=c.data;return p.percent||"0%"}}}]}),f.current.resize({height:M})}else f.current&&f.current.showLoading()},[l,i,a]),(0,e.jsx)("div",{ref:o})}),D=r(76826),k=r(42285),ve=(0,j.Pi)(function(n){var s,a,t=n.schema,l=(0,u.useContext)(I),h=l.loading,i=l.reportData,o=(0,k.YB)(),f=(0,u.useState)("horizontalBar"),M=(0,q.Z)(f,2),d=M[0],c=M[1],p=(i==null||(s=i.statistics[t.id])===null||s===void 0?void 0:s.total)||0,S=(0,u.useRef)(null),je=(0,u.useMemo)(function(){var B=o.formatMessage({id:"pages.survey.report.table.sum",defaultMessage:"\u5408\u8BA1"}),g=o.formatMessage({id:"pages.survey.report.table.average",defaultMessage:"\u5E73\u5747\u503C"}),x=o.formatMessage({id:"pages.survey.report.table.max",defaultMessage:"\u6700\u9AD8\u503C"}),y=o.formatMessage({id:"pages.survey.report.table.min",defaultMessage:"\u6700\u4F4E\u503C"}),v=o.formatMessage({id:"pages.survey.report.table.option",defaultMessage:"\u9009\u9879"}),C=o.formatMessage({id:"pages.survey.report.table.count",defaultMessage:"\u6570\u636E\u91CF"}),m=o.formatMessage({id:"pages.survey.report.table.ratio",defaultMessage:"\u5360\u6BD4"});if(t.type==="FillBlank"||t.type==="MultipleBlank"||t.type==="Score"||t.type==="Nps"){var b=[{title:B,dataIndex:"sum",width:"20%"},{title:g,dataIndex:"average",width:"20%"},{title:x,dataIndex:"max",width:"20%"},{title:y,dataIndex:"min",width:"20%"}];return t.type==="MultipleBlank"?[{title:v,dataIndex:"title",width:"20%"}].concat(b):b}return[{title:v,dataIndex:"title",width:"50%"},{title:C,dataIndex:"total",width:"25%",sorter:function(E,O){return E.total-O.total},showSorterTooltip:!1},{title:m,dataIndex:"percent",width:"25%",sorter:function(E,O){return parseFloat(E.percent)-parseFloat(O.percent)},showSorterTooltip:!1}]},[t.type,o]),Se=function(){var g,x=(g=S.current)===null||g===void 0?void 0:g.saveAsImage();x&&new J().convertFromInput(x,function(y){var v=document.createElement("a");v.href=y,v.download="".concat((0,D.WO)(t.title),".png"),v.click(),v.remove()})},Ce=function(){var g;return(g=t.children)===null||g===void 0?void 0:g.map(function(x){var y=x.id,v=x.title,C=(0,D.WO)(v),m=i==null?void 0:i.statistics[y];if(m){var b=m.total||0,F=Math.round(1e4*b/(p||1))/100+"%";if(!(i!=null&&i.search)||C.includes(i.search))return{id:y,title:C,total:b,percent:F,min:m.min,max:m.max,average:m.average,sum:m.sum}}return{id:y,title:C,total:0,percent:"0%"}})},be=function(){var g;if(t.type==="FillBlank"||t.type==="MatrixFillBlank"||t.type==="Score"||t.type==="Nps")return(0,e.jsx)(e.Fragment,{});var x=[],y=[];return(g=t.children)===null||g===void 0||g.forEach(function(v){var C=(0,D.WO)(v.title);if(x.push(C),!(i!=null&&i.search)||C.includes(i.search)){var m,b=(i==null||(m=i.statistics[v.id])===null||m===void 0?void 0:m.total)||0,F=Math.round(1e4*b/(p||1))/100+"%";y.push({percent:F,value:b})}else y.push({percent:"0%",value:0})}),(0,e.jsxs)(R.Z,{span:24,className:"question-chart",children:[(0,e.jsx)("div",{className:"question-chart-btns",children:(0,e.jsxs)(Z.Z.Group,{size:"small",children:[(0,e.jsx)(Z.Z,{type:"link",onClick:function(){return c("horizontalBar")},children:o.formatMessage({id:"pages.survey.report.chart.horizontalBar",defaultMessage:"\u6761\u5F62\u56FE"})}),(0,e.jsx)(Z.Z,{type:"link",onClick:function(){return c("bar")},children:o.formatMessage({id:"pages.survey.report.chart.verticalBar",defaultMessage:"\u67F1\u5F62\u56FE"})}),(0,e.jsx)(Z.Z,{type:"link",onClick:function(){return c("pie")},children:o.formatMessage({id:"pages.survey.report.chart.pie",defaultMessage:"\u6247\u5F62\u56FE"})}),(0,e.jsx)(Z.Z,{type:"link",icon:(0,e.jsx)("div",{className:"divider"})}),(0,e.jsx)(Z.Z,{type:"link",icon:(0,e.jsx)(_.Z,{}),onClick:Se})]})}),(0,e.jsx)("div",{children:(0,e.jsx)(de,{type:d,loading:h,labels:x,data:y,ref:S})})]})},Ie=function(){return(0,e.jsx)(R.Z,{span:24,children:(0,e.jsx)($.Z,{pagination:!1,size:"small",bordered:!0,columns:je,rowKey:"id",dataSource:Ce()})})};return(0,e.jsx)("div",{className:"question-item",children:(0,e.jsxs)(A.Z,{gutter:[12,12],className:"question-content",children:[(0,e.jsx)(R.Z,{xs:24,sm:12,children:(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(R.Z,{span:24,children:(0,e.jsx)("span",{className:"question-label",children:(0,D.WO)(t.title)})}),be()]})}),(0,e.jsx)(R.Z,{xs:24,sm:12,children:(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(R.Z,{span:24,children:(0,e.jsx)("div",{className:"question-title",children:(0,e.jsxs)("div",{className:"question-data-desc",children:[(0,e.jsx)("div",{children:o.formatMessage({id:"pages.survey.report.question.meta.type",defaultMessage:"\u7C7B\u578B\uFF1A{type}"},{type:G(o,t.type)})}),(0,e.jsx)("div",{children:o.formatMessage({id:"pages.survey.report.question.meta.required",defaultMessage:"\u5FC5\u586B\uFF1A{value}"},{value:(a=t.attribute)!==null&&a!==void 0&&a.required?o.formatMessage({id:"pages.survey.report.common.yes",defaultMessage:"\u662F"}):o.formatMessage({id:"pages.survey.report.common.no",defaultMessage:"\u5426"})})}),(0,e.jsx)("div",{children:o.formatMessage({id:"pages.survey.report.question.meta.total",defaultMessage:"\u5171 {count} \u6761\u6570\u636E"},{count:p})})]})})}),Ie()]})})]})})}),Be=r(59250),ce=r(13013),Fe=r(30887),fe=r(28682),we=r(47673),pe=r(77808),ge=r(19957),he=pe.Z.Search,me=(0,j.Pi)(function(){var n=(0,u.useContext)(I),s=n.reportData,a=(0,k.YB)(),t=(0,u.useMemo)(function(){return[{label:a.formatMessage({id:"pages.survey.report.header.filter.content",defaultMessage:"\u6309\u6570\u636E\u5185\u5BB9\u7B5B\u9009"}),key:"content"},{label:a.formatMessage({id:"pages.survey.report.header.filter.date",defaultMessage:"\u6309\u63D0\u4EA4\u65E5\u671F\u7B5B\u9009"}),key:"date"}]},[a]),l=(0,e.jsx)(fe.Z,{items:t});return(0,e.jsxs)("div",{className:"report-header",children:[(0,e.jsx)("span",{children:a.formatMessage({id:"pages.survey.report.header.summary",defaultMessage:"\u5171 {total} \u6761\u6570\u636E"},{total:(s==null?void 0:s.total)||0})}),(0,e.jsxs)("div",{children:[(0,e.jsx)(he,{size:"small",placeholder:a.formatMessage({id:"pages.survey.report.header.search.placeholder",defaultMessage:"\u641C\u7D22"}),onSearch:function(i){n.loadReportData(i)},style:{width:200,marginRight:10}}),(0,e.jsx)(ce.Z,{overlay:l,placement:"bottomRight",children:(0,e.jsx)(ge.Z,{style:{cursor:"pointer"}})})]})]})}),ye=function(){return(0,e.jsx)(me,{})},xe=function(){return(0,e.jsx)("div",{className:"report-container",children:(0,e.jsx)(K,{})})},z=(0,j.Pi)(function(){var n=(0,T.IE)(),s=(0,u.useMemo)(function(){return new L.Cu(n)},[n]);return(0,u.useEffect)(function(){s.loadReportData()},[]),(0,e.jsx)("div",{className:"survey-report",children:(0,e.jsxs)(N,{value:s,children:[(0,e.jsx)(ye,{}),(0,e.jsx)(xe,{})]})})}),Me=z},11628:function(U,w,r){"use strict";r.d(w,{xI:function(){return j},Ge:function(){return I},IE:function(){return T}});var u=r(67294),j=(0,u.createContext)({}),L=j.Provider;function T(){var N=(0,u.useContext)(j);return N.store}function I(){var N=T();return N.flowStore}}}]);
